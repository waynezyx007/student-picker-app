<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>学生随机抽查系统</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
        }

        /* 左侧导航栏 */
        .sidebar {
            width: 250px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            height: 100vh;
            position: fixed;
            padding: 20px 0;
            box-shadow: 3px 0 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }

        .logo {
            text-align: center;
            padding: 20px 0;
            font-size: 1.5rem;
            font-weight: bold;
            color: #5a67d8;
            border-bottom: 1px solid #edf2f7;
            margin-bottom: 20px;
        }

        .nav-menu {
            list-style: none;
            padding: 0 20px;
        }

        .nav-item {
            margin-bottom: 10px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            border-radius: 8px;
            color: #4a5568;
            text-decoration: none;
            transition: all 0.3s ease;
            gap: 10px;
        }

        .nav-link:hover {
            background: #edf2f7;
        }

        .nav-link.active {
            background: #5a67d8;
            color: white;
        }

        .nav-link i {
            width: 20px;
            text-align: center;
        }

        /* 主内容区域 */
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 30px;
            transition: margin-left 0.3s ease;
        }
        
        /* 导航栏隐藏状态 */
        .sidebar.collapsed {
            width: 0;
            overflow: hidden;
        }
        
        .main-content.full-width {
            margin-left: 0;
        }
        
        /* 导航栏切换按钮 */
        .toggle-sidebar-btn {
            position: fixed;
            left: 250px;
            top: 20px;
            width: 30px;
            height: 30px;
            background: #5a67d8;
            color: white;
            border: none;
            border-radius: 0 5px 5px 0;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: left 0.3s ease;
            z-index: 101;
        }
        
        .toggle-sidebar-btn:hover {
            background: #4c51bf;
        }
        
        .toggle-sidebar-btn.collapsed {
            left: 0;
        }

        .page {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            min-height: calc(100vh - 60px);
            max-width: 1600px;
            margin: 0 auto;
        }
        
        /* 大屏幕响应式布局 */
        @media (min-width: 1200px) {
            .page {
                padding: 40px;
            }
            
            .main-content {
                padding: 40px;
            }
        }
        
        @media (min-width: 1600px) {
            .main-content {
                padding: 50px;
            }
            
            .page {
                padding: 50px;
            }
        }

        .page.active {
            display: block;
        }

        .page-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #5a67d8;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* 主页样式 */
        .class-selector {
            margin-bottom: 30px;
        }

        .class-selector label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .checkbox-label {
            display: inline-flex;
            align-items: center;
            margin-right: 15px;
            margin-bottom: 10px;
            padding: 8px 12px;
            background: #edf2f7;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checkbox-label:hover {
            background: #e2e8f0;
        }

        .class-checkbox {
            margin-right: 5px;
            width: 14px;
            height: 14px;
        }

        .roller-container {
            height: 300px;
            background: #f8f9fa;
            border-radius: 15px;
            margin: 30px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
            border: 2px dashed #cbd5e0;
        }

        .roller-content {
            font-size: 3.5rem; /* 放大字号 */
            font-weight: bold;
            color: #5a67d8;
            text-align: center;
            padding: 20px;
        }

        .roller-list {
            list-style: none;
            padding: 0;
            margin: 0;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            transition: transform 0.1s linear;
        }

        .roller-item {
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3.5rem; /* 放大字号 */
            font-weight: bold;
        }

        .highlight {
            background: #48bb78 !important;
            color: white !important;
        }

        .controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 15px;
            z-index: 10;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-start {
            background: #48bb78;
            color: white;
        }

        .btn-start:hover:not(:disabled) {
            background: #38a169;
            transform: translateY(-2px);
        }

        .btn-stop {
            background: #ed8936;
            color: white;
        }

        .btn-stop:hover:not(:disabled) {
            background: #dd6b20;
            transform: translateY(-2px);
        }

        /* 成绩详情区域 */
        #selectedStudentScores {
            display: flex;
            flex-direction: column;
        }
            
        #scoresContainer {
            min-width: 100%;
        }

        /* 数据管理页面样式 */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .form-group input, .form-group textarea {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #cbd5e0;
            font-size: 1rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .btn-primary {
            background: #5a67d8;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: #4c51bf;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #e53e3e;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .btn-danger:hover {
            background: #c53030;
            transform: translateY(-2px);
        }

        /* 数据管理页面布局 */
        .data-management-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin-top: 20px;
        }

        .data-section {
            flex: 1;
        }

        /* 数据管理布局保持单列，确保表格宽度与页面一致 */
        .data-management-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin-top: 20px;
        }

        /* 分页控件样式 */
        .pagination-controls {
            margin-bottom: 15px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            padding: 10px 0;
            background: #f7fafc;
            border-radius: 8px;
            padding: 15px;
        }

        .pagination-left, .pagination-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .page-size-select {
            padding: 8px 12px;
            border-radius: 5px;
            border: 1px solid #cbd5e0;
            font-size: 1rem;
        }

        .pagination-info {
            font-weight: 500;
            color: #4a5568;
        }

        .pagination-btn {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .pagination-navigation {
            margin-top: 20px;
            text-align: center;
        }

        .page-numbers {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 5px;
        }

        .page-number {
            display: inline-block;
            padding: 8px 12px;
            margin: 0 2px;
            border: 1px solid #cbd5e0;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 40px;
        }

        .page-number.active {
            background: #5a67d8;
            color: white;
            border-color: #5a67d8;
        }

        .page-number:hover:not(.active) {
            background: #e2e8f0;
        }

        /* 学生表格容器 */
        .student-table-container {
            width: 100%;
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        
        .student-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            table-layout: fixed; /* 固定表格布局 */
        }

        .student-table th,
        .student-table td {
            padding: 8px 12px; /* 减少内边距 */
            text-align: left;
            border-bottom: 1px solid #edf2f7;
            white-space: normal; /* 允许内容换行 */
            word-wrap: break-word; /* 长单词换行 */
            max-width: 150px; /* 设置单元格最大宽度 */
            font-size: 0.8rem; /* 进一步缩小字体大小 */
            vertical-align: top;
        }

        .student-table th {
            background: #f7fafc;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
            white-space: nowrap; /* 表头保持不换行 */
        }

        .student-table tr:hover {
            background: #f7fafc;
        }
        
        /* 大屏幕表格优化 */
        @media (min-width: 1200px) {
            .student-table th,
            .student-table td {
                padding: 10px 15px; /* 适当增加大屏幕内边距 */
                max-width: 200px; /* 大屏幕可容纳更宽单元格 */
            }
        }

        .hidden {
            display: none;
        }

        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
        }

        .error {
            background: #fed7d7;
            color: #c53030;
        }

        .success {
            background: #c6f6d5;
            color: #2f855a;
        }

        .warning {
            background: #fefcbf;
            color: #975a16;
        }

        .stats {
            background: #f0fff4;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .stats h3 {
            margin-top: 0;
            color: #5a67d8;
            font-size: 1.5rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            background: #eef2ff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: #5a67d8;
        }

        .stat-content {
            flex: 1;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #5a67d8;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #718096;
            font-size: 1.1rem;
            font-weight: 500;
        }

        /* 学生列表显示区域 */
        .student-list-container {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            display: none;
        }

        .student-list-title {
            font-size: 1.3rem;
            color: #5a67d8;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .student-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .student-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .student-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .student-name {
            font-weight: bold;
            font-size: 1.1rem;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .student-id {
            color: #718096;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .student-scores-summary {
            font-size: 0.9rem;
            color: #4a5568;
        }

        @media (max-width: 1023px) {
            /* 数据管理页面响应式布局 */
            .data-management-container {
                flex-direction: column;
            }
            
            .data-section:first-child {
                flex: 1;
            }
        }
        
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
            }
            
            .sidebar span {
                display: none;
            }
            
            .main-content {
                margin-left: 70px;
                padding: 20px;
            }
            
            .page {
                padding: 20px;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            #selectedStudentScores {
                display: flex;
                flex-direction: column;
            }
            
            #scoresContainer {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- 左侧导航栏 -->
    <div class="sidebar">
        <div class="logo">
            <i class="fas fa-graduation-cap"></i>
            <span>学生抽查系统</span>
        </div>
        <ul class="nav-menu">
            <li class="nav-item">
                <a href="#" class="nav-link active" data-page="home">
                    <i class="fas fa-home"></i>
                    <span>主页</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" data-page="data">
                    <i class="fas fa-database"></i>
                    <span>数据管理</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" data-page="grades">
                    <i class="fas fa-graduation-cap"></i>
                    <span>成绩展示</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" data-page="settings">
                    <i class="fas fa-cog"></i>
                    <span>系统设置</span>
                </a>
            </li>
        </ul>
    </div>

    <!-- 导航栏切换按钮 -->
    <button class="toggle-sidebar-btn" id="toggleSidebar">
        <i class="fas fa-chevron-left"></i>
    </button>

    <!-- 主内容区域 -->
    <div class="main-content">
        <!-- 主页 -->
        <div id="home" class="page active">
            <h2 class="page-title">
                <i class="fas fa-random"></i>
                随机抽查
            </h2>
            
            <div class="filter-section" style="display: flex; flex-direction: column; margin-bottom: 20px;">
                <!-- 选择班级行 -->
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                    <label style="font-weight: bold;">选择班级：</label>
                    <div class="class-selector" style="display: flex; flex-direction: column;">
                        <div id="classCheckboxes" style="display: flex; flex-wrap: wrap; gap: 10px;">
                            <!-- 班级复选框将通过JavaScript动态生成 -->
                        </div>
                    </div>
                </div>
                <!-- 选择科目筛选行 -->
                <div style="display: flex; align-items: flex-start; gap: 10px;">
                    <label style="font-weight: bold;">选择科目筛选：</label>
                    
                    <div id="subjectFilter" style="display: flex; flex-direction: column; align-items: flex-start;">
                        <div id="subjectFilterButtons" style="display: flex; flex-direction: row; flex-wrap: nowrap; gap: 10px; overflow-x: auto; padding-bottom: 5px;">
                            <!-- 科目按钮将通过JavaScript动态生成 -->
                        </div>
                    </div>
                </div>
            </div>
            

            
            <style>
                /* 筛选区域大屏幕优化 */
                @media (min-width: 1200px) {
                    .filter-section {
                        justify-content: space-between;
                    }
                    
                    .class-selector {
                        flex: 2;
                    }
                    
                    #subjectFilter {
                        flex: 1;
                    }
                }
            </style>
            
            <div class="roller-container">
                <div class="roller-content" id="rollerContent">
                    点击开始抽取
                </div>
                
                <div class="controls">
                    <button id="startBtn" class="btn btn-start" disabled>
                        <i class="fas fa-play"></i>
                        开始
                    </button>
                    <button id="stopBtn" class="btn btn-stop" disabled>
                        <i class="fas fa-stop"></i>
                        停止
                    </button>
                </div>
            </div>
            
            <div id="selectedStudentScores" style="margin-top: 20px; display: none;">
                <h3 style="color: #5a67d8; margin-bottom: 15px;">学生成绩详情</h3>
                <div id="scoresContainer" style="min-width: 300px; display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px;">
                    <!-- 成绩将在这里动态显示 -->
                </div>
            </div>
        </div>

        <!-- 数据管理页面 -->
        <div id="data" class="page">
            <h2 class="page-title">
                <i class="fas fa-database"></i>
                数据管理
                <button id="importDataBtn" class="btn-primary" style="margin-left: 20px; font-size: 0.9rem; padding: 8px 16px;">
                    <i class="fas fa-file-import"></i>
                    导入数据
                </button>
                <button id="clearDataBtn" class="btn-danger" style="margin-left: 10px; font-size: 0.9rem; padding: 8px 16px;">
                    <i class="fas fa-trash-alt"></i>
                    清空所有数据
                </button>
            </h2>
            
            <div id="dataStatus" class="status-message hidden"></div>
            
            <div class="stats">
                <h3>数据统计</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="studentCount">0</div>
                            <div class="stat-label">学生总数</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-chalkboard-teacher"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="classCount">0</div>
                            <div class="stat-label">班级数量</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-book"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="subjectCount">0</div>
                            <div class="stat-label">科目数量</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="data-management-container">
                <!-- 学生列表 -->
                <div class="data-section">
                    <div class="form-section">
                        <h3>学生列表</h3>
                        <div style="overflow-x: auto;">
                            <!-- 添加分页控件 -->
                            <div id="paginationControls" class="pagination-controls">
                                <div class="pagination-left">
                                    <label for="pageSize">每页显示:</label>
                                    <select id="pageSize" class="page-size-select">
                                        <option value="10">10</option>
                                        <option value="20">20</option>
                                        <option value="50">50</option>
                                        <option value="0">全部</option>
                                    </select>
                                </div>
                                <div id="paginationInfo" class="pagination-info"></div>
                                <div class="pagination-right">
                                    <button id="prevPage" class="btn-primary pagination-btn">上一页</button>
                                    <button id="nextPage" class="btn-primary pagination-btn">下一页</button>
                                    <input type="file" id="csvFile" accept=".csv" style="display: none;">
                                </div>
                            </div>
                            
                            <div class="student-table-container">
                                <table class="student-table">
                                    <thead>
                                        <tr>
                                            <!-- 表头将通过JavaScript动态生成 -->
                                        </tr>
                                    </thead>
                                    <tbody id="studentTableBody">
                                        <tr>
                                            <td colspan="4" style="text-align: center;">暂无学生数据</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            

                            
                            <div id="paginationNavigation" class="pagination-navigation">
                                <div id="pageNumbers" class="page-numbers"></div>
                            </div>
                        </div>
                    </div>
                    

                </div>
            </div>
        </div>
        
        <!-- 成绩展示页面 -->
        <div id="grades" class="page">
            <h2 class="page-title">
                <i class="fas fa-graduation-cap"></i>
                成绩展示
            </h2>
            
            <div class="grade-display-container" style="display: flex; gap: 20px; width: 100%;">
                <!-- 左侧班级列表（复选框式） -->
                <div class="grade-class-list" style="width: 250px; min-width: 200px; border-right: 1px solid #e2e8f0; padding-right: 20px; flex-shrink: 0;">
                    <h3 style="margin-bottom: 15px;">选择班级</h3>
                    <div id="gradeClassCheckboxes" style="max-height: 600px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px;">
                        <!-- 班级复选框将通过JavaScript动态生成 -->
                    </div>
                    
                    <!-- 学生列表 -->
                    <div class="grade-student-list" style="margin-top: 20px;">
                        <h3 style="margin-bottom: 15px;">学生列表</h3>
                        <div style="margin-bottom: 10px;">
                            <input type="text" id="studentSearch" placeholder="搜索姓名或学号..." style="width: 100%; padding: 8px; border: 1px solid #cbd5e0; border-radius: 4px;">
                        </div>
                        <div id="gradeStudentList" style="max-height: 300px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: 8px;">
                            <!-- 学生列表将通过JavaScript动态生成 -->
                        </div>
                    </div>
                </div>
                
                <!-- 右侧学生列表和成绩详情 -->
                <div class="grade-student-section" style="flex: 1;">
                    <!-- 科目筛选 -->
                    <div class="grade-subject-filter" style="margin-bottom: 20px; padding: 15px; background: #f7fafc; border-radius: 8px;">
                        <h3 style="margin-bottom: 10px;">科目筛选</h3>
                        <div id="gradeSubjectFilters" style="display: flex; flex-wrap: wrap; gap: 10px;">
                            <!-- 科目筛选复选框将通过JavaScript动态生成 -->
                        </div>
                    </div>
                    
                    <!-- 成绩详情 -->
                    <div class="grade-details">
                        <h3 style="margin-bottom: 15px;">成绩详情</h3>
                        <div id="gradeDetails" style="min-height: 200px; display: block; padding: 20px 0;">
                            <!-- 学生成绩详情将通过JavaScript动态生成 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 系统设置页面 -->
        <div id="settings" class="page">
            <h2 class="page-title">
                <i class="fas fa-cog"></i>
                系统设置
            </h2>
            
            <div style="display: flex; flex-direction: column; gap: 30px;">
                <!-- 数据备份 -->
                <div class="setting-section">
                    <h3 style="font-size: 1.3rem; margin-bottom: 15px; color: #4a5568; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-download"></i>
                        数据备份
                    </h3>
                    <div style="background: #f7fafc; padding: 20px; border-radius: 10px; border: 1px solid #e2e8f0;">
                        <p style="margin-bottom: 15px; color: #718096;">备份当前系统中的所有学生和成绩数据到本地文件。</p>
                        <button id="backupDataBtn" class="btn btn-primary" style="margin-right: 10px;">
                            <i class="fas fa-save"></i>
                            备份数据
                        </button>
                        <span id="backupStatus" style="font-size: 0.9rem; color: #48bb78;"></span>
                    </div>
                </div>
                
                <!-- 数据恢复 -->
                <div class="setting-section">
                    <h3 style="font-size: 1.3rem; margin-bottom: 15px; color: #4a5568; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-upload"></i>
                        数据恢复
                    </h3>
                    <div style="background: #f7fafc; padding: 20px; border-radius: 10px; border: 1px solid #e2e8f0;">
                        <p style="margin-bottom: 15px; color: #718096;">从本地文件恢复之前备份的学生和成绩数据。</p>
                        <button id="restoreDataBtn" class="btn btn-secondary" style="margin-right: 10px;">
                            <i class="fas fa-undo"></i>
                            恢复数据
                        </button>
                        <input type="file" id="restoreFileInput" accept=".json" style="display: none;">
                        <span id="restoreStatus" style="font-size: 0.9rem; color: #48bb78;"></span>
                    </div>
                </div>
                
                <!-- 系统初始化 -->
                <div class="setting-section">
                    <h3 style="font-size: 1.3rem; margin-bottom: 15px; color: #4a5568; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-recycle"></i>
                        系统初始化
                    </h3>
                    <div style="background: #fef2f2; padding: 20px; border-radius: 10px; border: 1px solid #fecaca;">
                        <p style="margin-bottom: 15px; color: #dc2626; font-weight: bold;">警告：此操作将清空系统中的所有数据，包括学生信息和成绩记录。请确保已备份重要数据！</p>
                        <button id="initializeSystemBtn" class="btn btn-danger">
                            <i class="fas fa-exclamation-triangle"></i>
                            初始化系统
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 全局变量
        let students = [];
        let classes = [];
        let isRolling = false;
        let rollInterval;
        let currentIndex = 0;
        let currentPage = 1;
        let pageSize = 10; // 默认每页显示10条记录
        let selectedStudentIds = new Set(); // 已抽取学生的ID集合（用于不放回抽取）

        let selectedSubjects = []; // 当前筛选的科目列表（支持多选）
        
        // DOM元素
        const navLinks = document.querySelectorAll('.nav-link');
        const pages = document.querySelectorAll('.page');
        const rollerContent = document.getElementById('rollerContent');
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const dataStatus = document.getElementById('dataStatus');
        const studentCount = document.getElementById('studentCount');
        const classCount = document.getElementById('classCount');
        const subjectCount = document.getElementById('subjectCount');
        const studentTableBody = document.getElementById('studentTableBody');
        const clearDataBtn = document.getElementById('clearDataBtn');
        const pageSizeSelect = document.getElementById('pageSize');
        const prevPageBtn = document.getElementById('prevPage');
        const nextPageBtn = document.getElementById('nextPage');
        const paginationInfo = document.getElementById('paginationInfo');
        const pageNumbers = document.getElementById('pageNumbers');
        
        // 页面切换
        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const pageId = this.getAttribute('data-page');
                
                // 更新导航状态
                navLinks.forEach(l => l.classList.remove('active'));
                this.classList.add('active');
                
                // 切换页面
                pages.forEach(page => {
                    page.classList.remove('active');
                });
                document.getElementById(pageId).classList.add('active');
                
                // 如果是数据管理页面，刷新统计数据
                if (pageId === 'data') {
                    updateStats();
                    updateStudentTable();
                }
                
                // 如果是主页，确保按钮状态正确
                if (pageId === 'home') {
                    updateButtonStates();
                }
                
                // 如果是成绩展示页面，初始化成绩展示
                if (pageId === 'grades') {
                    initGradeDisplay();
                    // 添加搜索框事件监听器
                    const searchInput = document.getElementById('studentSearch');
                    if (searchInput) {
                        searchInput.addEventListener('input', updateGradeStudentListBySelectedClasses);
                    }
                }
            });
        });
        
        // 系统设置功能
        
        // 备份数据
        document.getElementById('backupDataBtn').addEventListener('click', function() {
            const data = {
                students: students,
                classes: classes,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `学生抽查系统备份_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
            
            // 显示备份成功信息
            const status = document.getElementById('backupStatus');
            status.textContent = '数据备份成功！';
            setTimeout(() => {
                status.textContent = '';
            }, 3000);
        });
        
        // 恢复数据
        document.getElementById('restoreDataBtn').addEventListener('click', function() {
            document.getElementById('restoreFileInput').click();
        });
        
        document.getElementById('restoreFileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // 验证数据格式
                    if (!data.students || !Array.isArray(data.students)) {
                        throw new Error('数据格式不正确：缺少有效的学生数据');
                    }
                    
                    // 确认恢复
                    if (confirm('确定要恢复数据吗？当前系统中的所有数据将被替换。')) {
                        // 恢复数据
                        students = data.students;
                        classes = data.classes || [];
                        
                        // 更新UI
                        updateClassSelector();
                        updateStats();
                        updateStudentTable();
                        updateSubjectFilter();
                        
                        // 保存到本地存储
                        saveData(); // 使用统一的保存函数，确保数据存储在正确的键中
                        
                        // 显示恢复成功信息
                        const status = document.getElementById('restoreStatus');
                        status.textContent = '数据恢复成功！';
                        setTimeout(() => {
                            status.textContent = '';
                        }, 3000);
                    }
                } catch (error) {
                    alert('恢复数据失败：' + error.message);
                }
            };
            reader.readAsText(file);
            
            // 重置文件输入
            this.value = '';
        });
        
        // 初始化系统
        document.getElementById('initializeSystemBtn').addEventListener('click', function() {
            if (confirm('确定要初始化系统吗？此操作将清空所有数据，且无法恢复！')) {
                if (confirm('再次确认：所有数据将被永久删除！确定要继续吗？')) {
                    // 调用清空所有数据函数，跳过额外的确认对话框
                    clearAllData(true);
                    
                    // 显示成功消息
                    showDataStatus('系统初始化成功，所有数据已清空', 'success');
                    alert('系统初始化完成！所有数据已清空。');
                }
            }
        });
        
        // 成绩展示相关函数
        
        // 初始化成绩展示页面
        function initGradeDisplay() {
            // 生成科目筛选框
            generateGradeSubjectFilters();
            
            // 生成班级列表
            generateGradeClassList();
        }
        
        // 生成科目筛选框
        function generateGradeSubjectFilters() {
            const container = document.getElementById('gradeSubjectFilters');
            container.innerHTML = '';
            
            // 获取所有唯一科目
            const subjects = new Set();
            students.forEach(student => {
                if (student.scores) {
                    Object.keys(student.scores).forEach(subject => {
                        // 如果科目名称包含下划线（如"月考1_语文"），提取下划线后的部分作为基本科目名称
                        // 否则直接使用科目名称
                        const basicSubject = subject.includes('_') ? subject.split('_')[1] : subject;
                        subjects.add(basicSubject);
                    });
                }
            });
            
            // 创建全选复选框
            const selectAllLabel = document.createElement('label');
            selectAllLabel.className = 'checkbox-label';
            selectAllLabel.style.display = 'flex';
            selectAllLabel.style.alignItems = 'center';
            selectAllLabel.style.gap = '5px';
            selectAllLabel.style.fontWeight = 'bold';
            selectAllLabel.innerHTML = `
                <input type="checkbox" checked id="selectAllSubjects" style="width: 16px; height: 16px;">
                全选
            `;
            
            // 添加全选复选框事件监听器
            selectAllLabel.querySelector('input').addEventListener('change', function() {
                const isChecked = this.checked;
                document.querySelectorAll('.grade-subject-checkbox').forEach(checkbox => {
                    checkbox.checked = isChecked;
                });
                updateGradeDisplay();
            });
            
            container.appendChild(selectAllLabel);
            
            // 创建科目复选框
            subjects.forEach(subject => {
                const checkbox = document.createElement('label');
                checkbox.className = 'checkbox-label';
                checkbox.style.display = 'flex';
                checkbox.style.alignItems = 'center';
                checkbox.style.gap = '5px';
                checkbox.innerHTML = `
                    <input type="checkbox" checked value="${subject}" class="grade-subject-checkbox">
                    ${subject}
                `;
                
                // 添加事件监听器
                checkbox.querySelector('input').addEventListener('change', function() {
                    // 检查是否所有科目都被选中，更新全选复选框状态
                    const allSubjectCheckboxes = document.querySelectorAll('.grade-subject-checkbox');
                    const allChecked = Array.from(allSubjectCheckboxes).every(cb => cb.checked);
                    document.getElementById('selectAllSubjects').checked = allChecked;
                    
                    updateGradeDisplay();
                });
                
                container.appendChild(checkbox);
            });
        }
        
        // 生成班级列表
        function generateGradeClassList() {
            const container = document.getElementById('gradeClassCheckboxes');
            container.innerHTML = '';
            
            // 获取所有唯一班级（同时考虑students数组和classes数组）
            // 从students数组中提取班级
            const classesFromStudents = [...new Set(students.map(student => student.class).filter(className => className))];
            // 合并两个数组并去重
            const allClasses = [...new Set([...classes, ...classesFromStudents])];
            
            // 如果没有班级数据，添加一些示例班级
            if (allClasses.length === 0) {
                allClasses.push('示例班级1', '示例班级2', '示例班级3');
            }
            
            // 创建班级复选框
            allClasses.forEach(className => {
                const label = document.createElement('label');
                label.className = 'checkbox-label';
                label.style.display = 'flex';
                label.style.alignItems = 'center';
                label.style.gap = '8px';
                label.style.cursor = 'pointer';
                label.style.padding = '8px 12px';
                label.style.borderRadius = '6px';
                label.style.transition = 'background-color 0.2s';
                label.style.userSelect = 'none';
                
                // 添加鼠标悬停效果
                label.addEventListener('mouseenter', function() {
                    if (!this.classList.contains('selected')) {
                        this.style.backgroundColor = '#f7fafc';
                    }
                });
                
                label.addEventListener('mouseleave', function() {
                    if (!this.classList.contains('selected')) {
                        this.style.backgroundColor = '';
                    }
                });
                
                label.innerHTML = `
                    <input type="checkbox" value="${className}" class="grade-class-checkbox" style="margin: 0;">
                    <span class="class-name">${className}</span>
                `;
                
                // 添加复选框变化事件
                const checkbox = label.querySelector('.grade-class-checkbox');
                checkbox.addEventListener('change', function() {
                    // 更新标签样式
                    if (this.checked) {
                        label.classList.add('selected');
                        label.style.backgroundColor = '#ebf8ff';
                    } else {
                        label.classList.remove('selected');
                        label.style.backgroundColor = '';
                    }
                    
                    // 更新学生列表
                    updateGradeStudentListBySelectedClasses();
                });
                
                container.appendChild(label);
            });
        }
        
        // 根据选中的班级更新学生列表
        function updateGradeStudentListBySelectedClasses() {
            // 获取所有选中的班级
            const selectedClasses = Array.from(document.querySelectorAll('.grade-class-checkbox:checked'))
                .map(cb => cb.value);
            
            const studentList = document.getElementById('gradeStudentList');
            
            if (selectedClasses.length === 0) {
                // 如果没有选中班级，显示提示信息
                studentList.innerHTML = '<div style="padding: 20px; text-align: center; color: #718096;">请选择班级</div>';
                return;
            }
            
            // 获取选中班级的所有学生
            let selectedStudents = students.filter(student => 
                selectedClasses.includes(student.class)
            );
            
            // 获取搜索关键词
            const searchInput = document.getElementById('studentSearch');
            const searchTerm = searchInput ? searchInput.value.trim().toLowerCase() : '';
            
            // 如果有搜索词，过滤学生列表
            if (searchTerm) {
                selectedStudents = selectedStudents.filter(student => 
                    student.name.toLowerCase().includes(searchTerm) || 
                    student.id.toLowerCase().includes(searchTerm)
                );
            }
            
            if (selectedStudents.length === 0) {
                // 检查是否是示例班级
                const hasExampleClass = selectedClasses.some(className => className.includes('示例班级'));
                if (hasExampleClass) {
                    studentList.innerHTML = '<div style="padding: 20px; text-align: center; color: #718096;">暂无学生数据，请先导入学生信息</div>';
                } else {
                    studentList.innerHTML = '<div style="padding: 20px; text-align: center; color: #718096;">选中的班级暂无学生数据</div>';
                }
                return;
            }
            
            // 清空学生列表
            studentList.innerHTML = '';
            
            // 创建学生列表项
            selectedStudents.forEach(student => {
                const studentItem = document.createElement('div');
                studentItem.className = 'grade-student-item';
                studentItem.style.padding = '10px';
                studentItem.style.marginBottom = '5px';
                studentItem.style.background = '#f7fafc';
                studentItem.style.borderRadius = '5px';
                studentItem.style.cursor = 'pointer';
                studentItem.style.transition = 'all 0.3s ease';
                studentItem.innerHTML = `
                    <div style="font-weight: bold;">${student.name}</div>
                    <div style="font-size: 0.8rem; color: #718096;">学号: ${student.id}</div>
                `;
                
                // 添加悬停效果
                studentItem.addEventListener('mouseenter', function() {
                    this.style.background = '#edf2f7';
                });
                
                studentItem.addEventListener('mouseleave', function() {
                    this.style.background = '#f7fafc';
                });
                
                // 添加点击事件
                studentItem.addEventListener('click', function() {
                    // 移除其他学生的选中状态
                    document.querySelectorAll('.grade-student-item').forEach(item => {
                        item.style.background = '#f7fafc';
                        item.style.borderLeft = 'none';
                    });
                    
                    // 添加当前学生的选中状态
                    this.style.background = '#e6fffa';
                    this.style.borderLeft = '4px solid #38b2ac';
                    
                    // 显示学生成绩详情
                    showStudentGradeDetails(student);
                });
                
                studentList.appendChild(studentItem);
            });
        }
        
        // 生成学生列表（保持原函数以便向后兼容）
        function generateGradeStudentList(className) {
            // 这个函数现在主要用于处理单个班级的情况，
            // 实际的学生列表更新逻辑已移至updateGradeStudentListBySelectedClasses
            const container = document.getElementById('gradeStudentList');
            
            // 选中对应的复选框
            document.querySelectorAll('.grade-class-checkbox').forEach(cb => {
                cb.checked = (cb.value === className);
                const label = cb.closest('label');
                if (cb.checked) {
                    label.classList.add('selected');
                    label.style.backgroundColor = '#ebf8ff';
                } else {
                    label.classList.remove('selected');
                    label.style.backgroundColor = '';
                }
            });
            
            // 调用更新函数
            updateGradeStudentListBySelectedClasses();
        }
        
        // 显示学生成绩详情
        function showStudentGradeDetails(student) {
            const container = document.getElementById('gradeDetails');
            container.innerHTML = '';
            
            // 获取选中的科目
            const selectedSubjects = [];
            document.querySelectorAll('.grade-subject-checkbox:checked').forEach(checkbox => {
                selectedSubjects.push(checkbox.value);
            });
            
            // 检查学生是否有成绩数据
            if (!student.scores || Object.keys(student.scores).length === 0) {
                // 没有成绩时显示提示信息
                const noDataMessage = document.createElement('div');
                noDataMessage.style.textAlign = 'center';
                noDataMessage.style.padding = '30px';
                noDataMessage.style.color = '#718096';
                noDataMessage.style.fontSize = '1.1rem';
                noDataMessage.innerHTML = '<i class="fas fa-info-circle"></i> 该学生暂无成绩数据';
                container.appendChild(noDataMessage);
                return;
            }
            
            // 根据选中的科目筛选（显示所有考试类型的成绩）
            const filteredScores = selectedSubjects.length > 0 
                ? Object.entries(student.scores).filter(([subject]) => {
                    // 检查科目名称是否包含任何选中的基本科目（如"月考1_语文"包含"语文"）
                    return selectedSubjects.some(selectedSubject => subject.includes(selectedSubject));
                })
                : Object.entries(student.scores);
            
            // 检查筛选后是否有成绩数据
            if (filteredScores.length === 0) {
                // 筛选后没有成绩时显示提示信息
                const noDataMessage = document.createElement('div');
                noDataMessage.style.textAlign = 'center';
                noDataMessage.style.padding = '30px';
                noDataMessage.style.color = '#718096';
                noDataMessage.style.fontSize = '1.1rem';
                noDataMessage.innerHTML = '<i class="fas fa-filter"></i> 根据当前筛选条件，该学生暂无成绩数据';
                container.appendChild(noDataMessage);
                return;
            }
            
            // 解析成绩数据，提取考试类型、科目名称和分数
            const parsedScores = filteredScores.map(([key, score]) => {
                if (key.includes('_')) {
                    const [examType, subjectName] = key.split('_');
                    return { examType, subjectName, score, key };
                } else {
                    return { examType: '其他', subjectName: key, score, key };
                }
            });
            
            // 提取所有唯一的考试类型和科目名称
            const allExamTypes = [...new Set(parsedScores.map(item => item.examType))];
            const allSubjectNames = [...new Set(parsedScores.map(item => item.subjectName))];
            
            // 对考试类型进行排序（按考试顺序排列）
            allExamTypes.sort((a, b) => {
                // 尝试按数字部分排序，如月考1 < 月考2
                const numA = parseInt(a.match(/\d+/)?.[0] || '0');
                const numB = parseInt(b.match(/\d+/)?.[0] || '0');
                if (numA !== numB) return numA - numB;
                return a.localeCompare(b);
            });
            
            // 对科目名称进行排序（按常见科目顺序排列）
            const subjectOrder = ['语文', '数学', '英语', '物理', '化学', '生物', '历史', '地理', '政治'];
            allSubjectNames.sort((a, b) => {
                const indexA = subjectOrder.findIndex(subj => a.includes(subj));
                const indexB = subjectOrder.findIndex(subj => b.includes(subj));
                if (indexA !== indexB) return indexA - indexB;
                return a.localeCompare(b);
            });
            
            // 创建表格容器
            const tableContainer = document.createElement('div');
            tableContainer.style.overflowX = 'auto';
            tableContainer.style.background = '#ffffff';
            tableContainer.style.borderRadius = '8px';
            tableContainer.style.boxShadow = '0 1px 3px rgba(0, 0, 0, 0.1)';
            
            // 创建表格
            const table = document.createElement('table');
            table.style.width = '100%';
            table.style.borderCollapse = 'collapse';
            table.style.fontSize = '0.9rem'; // 减小字体大小
            table.style.tableLayout = 'fixed'; // 使用固定表格布局
            
            // 创建表头
            const thead = document.createElement('thead');
            thead.style.backgroundColor = '#f7fafc';
            
            const headerRow = document.createElement('tr');
            
            // 添加考试类型列标题
            const examHeader = document.createElement('th');
            examHeader.style.padding = '8px 12px'; // 减少内边距
            examHeader.style.textAlign = 'left';
            examHeader.style.fontWeight = 'bold';
            examHeader.style.color = '#2d3748';
            examHeader.style.borderBottom = '2px solid #e2e8f0';
            examHeader.style.minWidth = '100px';
            examHeader.style.maxWidth = '150px'; // 设置最大宽度
            examHeader.style.whiteSpace = 'normal'; // 允许内容换行
            examHeader.style.wordWrap = 'break-word'; // 长单词换行
            examHeader.textContent = '考试类型';
            headerRow.appendChild(examHeader);
            
            // 添加各科目类型的列标题
            allSubjectNames.forEach(subjectName => {
                const subjectHeader = document.createElement('th');
                subjectHeader.style.padding = '8px 10px'; // 减少内边距
                subjectHeader.style.textAlign = 'center';
                subjectHeader.style.fontWeight = 'bold';
                subjectHeader.style.color = '#2d3748';
                subjectHeader.style.borderBottom = '2px solid #e2e8f0';
                subjectHeader.style.minWidth = '80px';
                subjectHeader.style.maxWidth = '120px'; // 设置最大宽度
                subjectHeader.style.whiteSpace = 'normal'; // 允许内容换行
                subjectHeader.style.wordWrap = 'break-word'; // 长单词换行
                subjectHeader.style.verticalAlign = 'top';
                
                // 创建包含图标和名称的容器
                const subjectContainer = document.createElement('div');
                subjectContainer.style.display = 'flex';
                subjectContainer.style.flexDirection = 'column'; // 垂直排列图标和名称
                subjectContainer.style.alignItems = 'center';
                subjectContainer.style.justifyContent = 'center';
                subjectContainer.style.gap = '5px';
                
                // 添加科目图标
                const subjectIcon = document.createElement('i');
                subjectIcon.style.fontSize = '1rem';
                subjectIcon.style.color = '#5a67d8';
                
                // 根据科目名称选择不同的图标
                let iconClass = 'fa-book'; // 默认图标
                if (subjectName.includes('语文')) iconClass = 'fa-language';
                else if (subjectName.includes('数学')) iconClass = 'fa-calculator';
                else if (subjectName.includes('英语')) iconClass = 'fa-flag-usa';
                else if (subjectName.includes('物理')) iconClass = 'fa-bolt';
                else if (subjectName.includes('化学')) iconClass = 'fa-flask';
                else if (subjectName.includes('生物')) iconClass = 'fa-dna';
                else if (subjectName.includes('历史')) iconClass = 'fa-landmark';
                else if (subjectName.includes('地理')) iconClass = 'fa-globe';
                else if (subjectName.includes('政治')) iconClass = 'fa-gavel';
                
                subjectIcon.className = `fas ${iconClass}`;
                subjectContainer.appendChild(subjectIcon);
                subjectContainer.appendChild(document.createTextNode(subjectName));
                subjectHeader.appendChild(subjectContainer);
                headerRow.appendChild(subjectHeader);
            });
            
            thead.appendChild(headerRow);
            table.appendChild(thead);
            
            // 创建表体
            const tbody = document.createElement('tbody');
            
            // 为每个考试类型创建行
            allExamTypes.forEach((examType, examIndex) => {
                const row = document.createElement('tr');
                row.style.borderBottom = '1px solid #f1f5f9';
                row.style.transition = 'background-color 0.2s';
                
                // 添加鼠标悬停效果
                row.addEventListener('mouseenter', function() {
                    this.style.backgroundColor = '#f8fafc';
                });
                
                row.addEventListener('mouseleave', function() {
                    this.style.backgroundColor = '';
                });
                
                // 添加考试类型单元格
                const examCell = document.createElement('td');
                examCell.style.padding = '8px 12px'; // 减少内边距
                examCell.style.fontWeight = '500';
                examCell.style.color = '#4a5568';
                examCell.style.fontSize = '0.9rem';
                examCell.style.whiteSpace = 'normal'; // 允许内容换行
                examCell.style.wordWrap = 'break-word'; // 长单词换行
                examCell.style.maxWidth = '150px'; // 设置最大宽度
                examCell.style.verticalAlign = 'top';
                examCell.textContent = examType;
                row.appendChild(examCell);
                
                // 为每个科目添加成绩单元格
                allSubjectNames.forEach(subjectName => {
                    const scoreCell = document.createElement('td');
                    scoreCell.style.padding = '8px 10px'; // 减少内边距
                    scoreCell.style.textAlign = 'center';
                    scoreCell.style.fontWeight = 'bold';
                    scoreCell.style.color = '#2d3748';
                    scoreCell.style.maxWidth = '120px'; // 设置最大宽度
                    scoreCell.style.whiteSpace = 'normal'; // 允许内容换行
                    scoreCell.style.wordWrap = 'break-word'; // 长单词换行
                    scoreCell.style.verticalAlign = 'top';
                    
                    // 查找该科目的成绩
                    const scoreItem = parsedScores.find(item => 
                        item.subjectName === subjectName && item.examType === examType
                    );
                    
                    if (scoreItem) {
                        // 创建包含分数和箭头的容器
                        const scoreContainer = document.createElement('div');
                        scoreContainer.style.display = 'flex';
                        scoreContainer.style.alignItems = 'center';
                        scoreContainer.style.justifyContent = 'center';
                        scoreContainer.style.gap = '5px';
                        
                        // 添加分数
                        const scoreValue = document.createElement('span');
                        scoreValue.style.fontSize = '1.2rem'; // 进一步缩小字体大小
                        scoreValue.style.color = '#5a67d8';
                        scoreValue.textContent = scoreItem.score;
                        scoreContainer.appendChild(scoreValue);
                        
                        // 计算进步/退步（与上一次考试的同一科目比较）
                        if (examIndex > 0) {
                            // 获取上一次考试类型
                            const previousExamType = allExamTypes[examIndex - 1];
                            // 查找上一次考试的成绩
                            const previousScoreItem = parsedScores.find(item => 
                                item.subjectName === subjectName && item.examType === previousExamType
                            );
                            
                            if (previousScoreItem) {
                                const currentScore = parseFloat(scoreItem.score);
                                const previousScore = parseFloat(previousScoreItem.score);
                                
                                // 判断是否是班次或级次（这两种数值越小越好）
                            const isRankSubject = subjectName.includes('班次') || subjectName.includes('级次');
                            
                            // 添加进步/退步箭头
                            if (isRankSubject) {
                                // 对于班次和级次，数值越小越好
                                if (currentScore < previousScore) {
                                    const arrowUp = document.createElement('i');
                                    arrowUp.className = 'fas fa-arrow-up';
                                    arrowUp.style.color = '#e53e3e'; // 红色箭头表示进步
                                    arrowUp.style.fontSize = '0.8rem';
                                    scoreContainer.appendChild(arrowUp);
                                } else if (currentScore > previousScore) {
                                    const arrowDown = document.createElement('i');
                                    arrowDown.className = 'fas fa-arrow-down';
                                    arrowDown.style.color = '#48bb78'; // 绿色箭头表示退步
                                    arrowDown.style.fontSize = '0.8rem';
                                    scoreContainer.appendChild(arrowDown);
                                }
                            } else {
                                // 对于普通分数，数值越大越好
                                if (currentScore > previousScore) {
                                    const arrowUp = document.createElement('i');
                                    arrowUp.className = 'fas fa-arrow-up';
                                    arrowUp.style.color = '#e53e3e'; // 红色箭头表示进步
                                    arrowUp.style.fontSize = '0.8rem';
                                    scoreContainer.appendChild(arrowUp);
                                } else if (currentScore < previousScore) {
                                    const arrowDown = document.createElement('i');
                                    arrowDown.className = 'fas fa-arrow-down';
                                    arrowDown.style.color = '#48bb78'; // 绿色箭头表示退步
                                    arrowDown.style.fontSize = '0.8rem';
                                    scoreContainer.appendChild(arrowDown);
                                }
                            }
                                // 成绩相同则不显示箭头
                            }
                        }
                        
                        scoreCell.appendChild(scoreContainer);
                    } else {
                        // 没有成绩时显示横杠
                        scoreCell.textContent = '-';
                        scoreCell.style.color = '#94a3b8';
                        scoreCell.style.fontWeight = 'normal';
                    }
                    
                    row.appendChild(scoreCell);
                });
                
                tbody.appendChild(row);
            });
            
            table.appendChild(tbody);
            tableContainer.appendChild(table);
            container.appendChild(tableContainer);
            

        }
        
        // 更新成绩展示
        function updateGradeDisplay() {
            // 由于现在使用复选框，直接调用更新函数
            updateGradeStudentListBySelectedClasses();
        }
        
        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 导航栏切换功能
            const toggleBtn = document.getElementById('toggleSidebar');
            const sidebar = document.querySelector('.sidebar');
            const mainContent = document.querySelector('.main-content');
            
            toggleBtn.addEventListener('click', function() {
                sidebar.classList.toggle('collapsed');
                mainContent.classList.toggle('full-width');
                this.classList.toggle('collapsed');
                
                // 切换按钮图标
                const icon = this.querySelector('i');
                if (sidebar.classList.contains('collapsed')) {
                    icon.classList.remove('fa-chevron-left');
                    icon.classList.add('fa-chevron-right');
                } else {
                    icon.classList.remove('fa-chevron-right');
                    icon.classList.add('fa-chevron-left');
                }
            });
            
            // 加载数据
            loadData();
            
            // 更新UI
            updateClassSelector();
            updateStats();
            updateStudentTable();
            
            // 绑定主页开始和停止按钮事件
            if (startBtn && stopBtn) {
                startBtn.addEventListener('click', startRolling);
                stopBtn.addEventListener('click', stopRolling);
            }
            
            // 绑定数据管理页面事件
            if (clearDataBtn) {
                console.log('清空数据按钮已找到，添加事件监听器');
                clearDataBtn.addEventListener('click', function() {
                    console.log('清空数据按钮被点击');
                    clearAllData();
                });
            } else {
                console.error('清空数据按钮未找到！');
                // 尝试在DOM加载完成后重新获取并绑定
                setTimeout(function() {
                    const btn = document.getElementById('clearDataBtn');
                    if (btn) {
                        console.log('延迟找到清空数据按钮，添加事件监听器');
                        btn.addEventListener('click', function() {
                            console.log('清空数据按钮被点击');
                            clearAllData();
                        });
                    }
                }, 1000);
            }
            
            // 添加导入按钮事件监听器
            const importDataBtn = document.getElementById('importDataBtn');
            const csvFile = document.getElementById('csvFile');
            
            if (importDataBtn && csvFile) {
                importDataBtn.addEventListener('click', function() {
                    csvFile.click();
                });
                
                csvFile.addEventListener('change', function(e) {
                    if (e.target.files.length > 0) {
                        processCSV(e.target.files[0]);
                        // 清空文件输入，以便可以重复导入相同文件
                        e.target.value = '';
                    }
                });
            }
            
            // 分页控件事件监听器
            if (pageSizeSelect && prevPageBtn && nextPageBtn) {
                pageSizeSelect.addEventListener('change', () => {
                    currentPage = 1; // 重置到第一页
                    updateStudentTable();
                });
                
                prevPageBtn.addEventListener('click', prevPage);
                nextPageBtn.addEventListener('click', nextPage);
            }
        });
        
        // 加载数据
        function loadData() {
            const storedData = localStorage.getItem('studentData');
            if (storedData) {
                students = JSON.parse(storedData);
                // 提取班级列表
                classes = [...new Set(students.map(s => s.class))];
            } else {
                // 当没有存储数据时，保持学生和班级数组为空
                students = [];
                classes = [];
                console.log('没有找到存储的数据，学生和班级数组已初始化为空');
            }
        }
        
        // 保存数据
        function saveData() {
            localStorage.setItem('studentData', JSON.stringify(students));
        }
        
        // 保存学生数据
        function saveStudents() {
            localStorage.setItem('studentData', JSON.stringify(students));
        }
        

        
        // 更新班级选择器
        function updateClassSelector() {
            const container = document.getElementById('classCheckboxes');
            container.innerHTML = '';
            
            classes.forEach(className => {
                const label = document.createElement('label');
                label.className = 'checkbox-label';
                label.innerHTML = `
                    <input type="checkbox" value="${className}" class="class-checkbox">
                    ${className}
                `;
                container.appendChild(label);
            });
            
            // 添加复选框事件监听器
            document.querySelectorAll('.class-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    updateButtonStates();
                    updateSubjectFilter(); // 更新科目筛选按钮
                });
            });
            
            // 初始化按钮状态
            updateButtonStates();
            
            // 更新按钮状态
            updateButtonStates();
            updateSubjectFilter(); // 更新科目筛选按钮
        }
        
        // 兼容函数：updateClassCheckboxes
        // 为了兼容可能存在的旧代码调用
        function updateClassCheckboxes() {
            updateClassSelector();
        }
        
        // 更新科目筛选按钮
        function updateSubjectFilter() {
            const subjectFilter = document.getElementById('subjectFilter');
            const subjectFilterButtons = document.getElementById('subjectFilterButtons');
            
            // 获取选定班级的学生
            const selectedClasses = Array.from(document.querySelectorAll('.class-checkbox:checked'))
                .map(cb => cb.value);
            const classStudents = students.filter(s => selectedClasses.includes(s.class));
            
            // 如果有选定班级且有学生，显示科目筛选按钮
            if (selectedClasses.length > 0 && classStudents.length > 0) {
                subjectFilter.style.display = 'flex';
                
                // 获取所有基本科目（从完整科目名称中提取）
                const allSubjects = new Set();
                classStudents.forEach(student => {
                    if (student.scores) {
                        Object.keys(student.scores).forEach(subject => {
                            // 如果科目名称包含下划线（如"月考1_语文"），提取下划线后的部分作为基本科目名称
                            // 否则直接使用科目名称（包括总分）
                            const basicSubject = subject.includes('_') ? subject.split('_')[1] : subject;
                            allSubjects.add(basicSubject);
                        });
                    }
                });
                
                // 确保总分总是包含在内（如果有任何总分数据）
                classStudents.forEach(student => {
                    if (student.scores) {
                        Object.keys(student.scores).forEach(subject => {
                            if (subject.includes('总分') || subject === '总分') {
                                allSubjects.add('总分');
                            }
                        });
                    }
                });
                
                const subjects = Array.from(allSubjects);
                
                // 清空并重新生成按钮
                subjectFilterButtons.innerHTML = '';
                
                // 添加"全部"按钮
                const allButton = document.createElement('button');
                allButton.className = 'btn-primary';
                allButton.style.padding = '8px 12px';
                allButton.style.fontSize = '0.9rem';
                allButton.style.margin = '2px';
                allButton.textContent = '全部';
                if (selectedSubjects.length === 0) {
                    allButton.style.background = '#e53e3e'; // 红色背景
                }
                allButton.addEventListener('click', function() {
                    // 清空所有选中的科目
                    selectedSubjects = [];
                    // 更新所有按钮的样式
                    document.querySelectorAll('#subjectFilterButtons button').forEach(btn => {
                        btn.style.background = '';
                    });
                    // 设置当前按钮为选中状态
                    this.style.background = '#e53e3e';
                    updateButtonStates();
                });
                subjectFilterButtons.appendChild(allButton);
                
                // 为每个科目创建按钮
                subjects.forEach(subject => {
                    const button = document.createElement('button');
                    button.className = 'btn-primary';
                    button.style.padding = '8px 12px';
                    button.style.fontSize = '0.9rem';
                    button.style.margin = '2px';
                    button.textContent = subject;
                    if (selectedSubjects.includes(subject)) {
                        button.style.background = '#e53e3e'; // 红色背景
                    }
                    button.addEventListener('click', function() {
                        // 切换科目选中状态
                        const index = selectedSubjects.indexOf(subject);
                        if (index >= 0) {
                            // 如果已选中，则取消选中
                            selectedSubjects.splice(index, 1);
                            this.style.background = '';
                        } else {
                            // 如果未选中，则选中
                            selectedSubjects.push(subject);
                            this.style.background = '#e53e3e';
                        }
                        // 如果有选中的科目，则取消"全部"按钮的选中状态
                        if (selectedSubjects.length > 0) {
                            document.querySelector('#subjectFilterButtons button').style.background = '';
                        } else {
                            // 如果没有选中的科目，则选中"全部"按钮
                            document.querySelector('#subjectFilterButtons button').style.background = '#e53e3e';
                        }
                        updateButtonStates();
                    });
                    subjectFilterButtons.appendChild(button);
                });
            } else {
                subjectFilter.style.display = 'none';
            }
        }
        
        // 更新按钮状态
        function updateButtonStates() {
            const selectedClasses = Array.from(document.querySelectorAll('.class-checkbox:checked'))
                .map(cb => cb.value);
            const classStudents = students.filter(s => selectedClasses.includes(s.class));
            
            if (selectedClasses.length > 0 && classStudents.length > 0) {
                if (startBtn) startBtn.disabled = false;
            } else {
                if (startBtn) startBtn.disabled = true;
            }
            
            if (stopBtn) stopBtn.disabled = !isRolling;
        }
        
        // 更新学生列表显示
        function updateStudentListDisplay(selectedClasses) {
            // 如果没有传入参数，则从主页的复选框获取
            if (!selectedClasses) {
                selectedClasses = Array.from(document.querySelectorAll('.class-checkbox:checked'))
                    .map(cb => cb.value);
            }
            
            const studentListContainer = document.getElementById('studentListContainer');
            const studentList = document.getElementById('studentList');
            
            if (selectedClasses.length > 0) {
                // 显示学生列表容器
                studentListContainer.style.display = 'block';
                
                // 获取选中班级的所有学生
                const classStudents = students.filter(s => selectedClasses.includes(s.class));
                
                // 清空学生列表
                studentList.innerHTML = '';
                
                if (classStudents.length > 0) {
                    // 为每个学生创建卡片
                    classStudents.forEach(student => {
                        const studentCard = document.createElement('div');
                        studentCard.className = 'student-card';
                        
                        // 计算成绩概要
                        let scoreSummary = '暂无成绩';
                        if (student.scores && Object.keys(student.scores).length > 0) {
                            const scores = Object.values(student.scores).map(score => parseFloat(score)).filter(score => !isNaN(score));
                            if (scores.length > 0) {
                                const avgScore = scores.reduce((a, b) => a + b, 0) / scores.length;
                                scoreSummary = `平均分: ${avgScore.toFixed(1)} (${scores.length}科)`;
                            }
                        }
                        
                        studentCard.innerHTML = `
                            <div class="student-name">${student.name}</div>
                            <div class="student-id">学号: ${student.id}</div>
                            <div class="student-scores-summary">${scoreSummary}</div>
                        `;
                        
                        studentList.appendChild(studentCard);
                    });
                } else {
                    studentList.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 20px; color: #718096;">所选班级暂无学生数据</div>';
                }
            } else {
                // 隐藏学生列表容器
                studentListContainer.style.display = 'none';
            }
        }
        // 获取选定班级的学生
        function getSelectedClassStudents() {
            const selectedClasses = Array.from(document.querySelectorAll('.class-checkbox:checked'))
                .map(cb => cb.value);
            let filteredStudents = [];
            
            // 只有过滤学生如果选择了班级
            if (selectedClasses.length > 0) {
                filteredStudents = students.filter(s => selectedClasses.includes(s.class));
            }
            
            // 如果选择了特定科目，进一步筛选
            if (selectedSubjects.length > 0) {
                filteredStudents = filteredStudents.filter(student => {
                    if (!student.scores) return false;
                    
                    // 检查学生是否有选中的科目成绩
                    // 如果学生的成绩中包含任何选中基本科目的考试成绩（如"月考1_语文"包含"语文"），则返回true
                    return selectedSubjects.some(selectedSubject => 
                        Object.keys(student.scores).some(studentSubject => 
                            studentSubject.includes(selectedSubject)
                        )
                    );
                });
            }
            
            return filteredStudents;
        }
        
        // 开始滚动
        function startRolling() {
            if (isRolling) return;
            
            const classStudents = getSelectedClassStudents();
            if (classStudents.length === 0) {
                rollerContent.innerHTML = '<div style="font-size: 1.5rem; color: #e53e3e;">请选择包含学生的班级</div>';
                return;
            }
            
            isRolling = true;
            updateButtonStates();
            
            // 清除之前的内容
            rollerContent.innerHTML = '';
            
            // 创建滚动列表
            const list = document.createElement('ul');
            list.className = 'roller-list';
            
            // 添加学生项（重复几次以确保足够滚动）
            for (let i = 0; i < Math.max(50, classStudents.length * 2); i++) {
                const student = classStudents[Math.floor(Math.random() * classStudents.length)];
                const item = document.createElement('li');
                item.className = 'roller-item';
                item.textContent = student.name;
                list.appendChild(item);
            }
            
            rollerContent.appendChild(list);
            
            // 开始滚动动画
            let position = 0;
            
            // 加快速度：将间隔从50ms减少到20ms，增加移动距离从5px到15px
            rollInterval = setInterval(() => {
                position -= 15; // 增加移动速度
                list.style.transform = `translateY(${position}px)`;
            }, 20); // 加快速度：减少间隔时间
        }
        
        // 获取学生的平均成绩（计算所有成绩的平均值）
        function getStudentTotalScore(student) {
            if (!student.scores) return 0;
            
            let allScores = [];
            
            // 获取所有非总分科目的成绩
            Object.entries(student.scores).forEach(([subject, score]) => {
                // 跳过总分项，只计算单科成绩
                if (!subject.includes('总分') && subject !== '总分') {
                    const numericScore = parseFloat(score);
                    if (!isNaN(numericScore)) {
                        allScores.push(numericScore);
                    }
                }
            });
            
            // 如果有总分成绩，优先使用总分
            let totalScores = [];
            Object.entries(student.scores).forEach(([subject, score]) => {
                if (subject.includes('总分') || subject === '总分') {
                    const numericScore = parseFloat(score);
                    if (!isNaN(numericScore)) {
                        totalScores.push(numericScore);
                    }
                }
            });
            
            // 优先使用总分计算平均分
            if (totalScores.length > 0) {
                return totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
            }
            // 如果没有总分，使用单科成绩计算平均分
            else if (allScores.length > 0) {
                return allScores.reduce((sum, score) => sum + score, 0) / allScores.length;
            }
            
            // 如果没有任何成绩，返回0
            return 0;
        }
        
        // 获取学生的平均成绩（计算所有成绩的平均值）
        function getStudentTotalScore(student) {
            if (!student.scores) return 0;
            
            let allScores = [];
            
            // 获取所有非总分科目的成绩
            Object.entries(student.scores).forEach(([subject, score]) => {
                // 跳过总分项，只计算单科成绩
                if (!subject.includes('总分') && subject !== '总分') {
                    const numericScore = parseFloat(score);
                    if (!isNaN(numericScore)) {
                        allScores.push(numericScore);
                    }
                }
            });
            
            // 如果有总分成绩，优先使用总分
            let totalScores = [];
            Object.entries(student.scores).forEach(([subject, score]) => {
                if (subject.includes('总分') || subject === '总分') {
                    const numericScore = parseFloat(score);
                    if (!isNaN(numericScore)) {
                        totalScores.push(numericScore);
                    }
                }
            });
            
            // 优先使用总分计算平均分
            if (totalScores.length > 0) {
                return totalScores.reduce((sum, score) => sum + score, 0) / totalScores.length;
            }
            // 如果没有总分，使用单科成绩计算平均分
            else if (allScores.length > 0) {
                return allScores.reduce((sum, score) => sum + score, 0) / allScores.length;
            }
            
            // 如果没有任何成绩，返回0
            return 0;
        }
        
        // 不放回随机选择学生
        function randomSelect(students) {
            // 确保有学生数据
            if (!students || students.length === 0) {
                console.error('没有学生数据可抽取');
                return null;
            }
            
            // 过滤出未被抽取的学生
            const availableStudents = students.filter(student => 
                !selectedStudentIds.has(`${student.class}-${student.id}`)
            );
            
            // 如果所有学生都已抽取完，清空已抽取记录
            if (availableStudents.length === 0) {
                selectedStudentIds.clear();
                return randomSelect(students); // 重新抽取
            }
            
            // 随机选择一个学生
            const randomIndex = Math.floor(Math.random() * availableStudents.length);
            const selectedStudent = availableStudents[randomIndex];
            
            // 标记学生为已抽取
            selectedStudentIds.add(`${selectedStudent.class}-${selectedStudent.id}`);
            
            return selectedStudent;
        }
        
        // 停止滚动
        function stopRolling() {
            if (!isRolling) return;
            
            clearInterval(rollInterval);
            isRolling = false;
            updateButtonStates();
            
            // 获取选中班级的学生
            const classStudents = getSelectedClassStudents();
            
            // 确保有学生数据
            if (classStudents.length === 0) {
                rollerContent.innerHTML = '<div style="font-size: 1.5rem; color: #e53e3e;">暂无学生数据</div>';
                return;
            }
            
            try {
                // 使用不放回随机选择算法
                const selectedStudent = randomSelect(classStudents);
                
                // 确保成功选中了学生
                if (selectedStudent) {
                    // 显示最终结果，在名字下方显示班级和学号
                rollerContent.innerHTML = `
                    <div style="font-size: 3.5rem; font-weight: bold; color: #48bb78;">${selectedStudent.name}</div>
                    <div style="font-size: 1.2rem; color: #718096; margin-top: 10px;">班级：${selectedStudent.class} | 学号：${selectedStudent.id}</div>
                `;
                    
                    // 显示学生成绩
                    displayStudentScores(selectedStudent);
                } else {
                    // 如果没有选中学生，显示错误信息
                    rollerContent.innerHTML = '<div style="font-size: 1.5rem; color: #e53e3e;">选择学生失败</div>';
                }
            } catch (error) {
                console.error('停止滚动时出错:', error);
                rollerContent.innerHTML = '<div style="font-size: 1.5rem; color: #e53e3e;">操作出错</div>';
            }
        }
        
        // 显示学生成绩
        function displayStudentScores(student) {
            // 获取成绩显示区域元素
            const scoresContainer = document.getElementById('scoresContainer');
            const scoresSection = document.getElementById('selectedStudentScores');
            
            // 确保元素存在
            if (!scoresContainer || !scoresSection) {
                console.error('成绩显示容器元素未找到');
                return;
            }
            
            // 清空之前的内容
            scoresContainer.innerHTML = '';
            
            // 始终显示成绩区域
            scoresSection.style.display = 'block';
            
            // 设置容器基本样式
            scoresContainer.style.display = 'flex';
            scoresContainer.style.flexDirection = 'column';
            scoresContainer.style.gap = '20px';
            scoresContainer.style.marginTop = '15px';
            scoresContainer.style.background = 'white';
            scoresContainer.style.borderRadius = '12px';
            scoresContainer.style.padding = '20px';
            scoresContainer.style.boxShadow = '0 4px 6px rgba(0, 0, 0, 0.05)';
            
            // 移除学生基本信息显示，仅显示成绩数据
            
            // 检查学生是否有成绩数据
            if (!student.scores || Object.keys(student.scores).length === 0) {
                // 没有成绩时显示提示信息
                const noDataMessage = document.createElement('div');
                noDataMessage.style.textAlign = 'center';
                noDataMessage.style.padding = '30px';
                noDataMessage.style.color = '#718096';
                noDataMessage.style.fontSize = '1.1rem';
                noDataMessage.innerHTML = '<i class="fas fa-info-circle"></i> 该学生暂无成绩数据';
                scoresContainer.appendChild(noDataMessage);
                return;
            }
            
            // 根据选中的科目筛选（显示所有考试类型的成绩）
            const filteredScores = selectedSubjects.length > 0 
                ? Object.entries(student.scores).filter(([subject]) => {
                    // 检查科目名称是否包含任何选中的基本科目（如"月考1_语文"包含"语文"）
                    return selectedSubjects.some(selectedSubject => subject.includes(selectedSubject));
                })
                : Object.entries(student.scores);
            
            // 检查筛选后是否有成绩数据
            if (filteredScores.length === 0) {
                // 筛选后没有成绩时显示提示信息
                const noDataMessage = document.createElement('div');
                noDataMessage.style.textAlign = 'center';
                noDataMessage.style.padding = '30px';
                noDataMessage.style.color = '#718096';
                noDataMessage.style.fontSize = '1.1rem';
                noDataMessage.innerHTML = '<i class="fas fa-filter"></i> 根据当前筛选条件，该学生暂无成绩数据';
                scoresContainer.appendChild(noDataMessage);
                return;
            }
            
            // 按考试类型分组科目成绩
            const scoresByExamType = {};
            
            // 按考试类型分组
            filteredScores.forEach(([subject, score]) => {
                if (subject.includes('_')) {
                    const [examType, subjectName] = subject.split('_');
                    if (!scoresByExamType[examType]) {
                        scoresByExamType[examType] = {};
                    }
                    scoresByExamType[examType][subjectName] = score;
                } else {
                    // 没有考试类型的科目，使用"其他"作为分组
                    if (!scoresByExamType['其他']) {
                        scoresByExamType['其他'] = {};
                    }
                    scoresByExamType['其他'][subject] = score;
                }
            });
            
            // 为每个考试类型创建分组容器
            Object.entries(scoresByExamType).forEach(([examType, subjects]) => {
                try {
                    // 创建考试类型分组容器
                    const examGroup = document.createElement('div');
                    examGroup.style.background = '#f7fafc';
                    examGroup.style.borderRadius = '8px';
                    examGroup.style.padding = '15px';
                    examGroup.style.marginBottom = '10px';
                    
                    // 添加考试类型标题
                    const examTypeTitle = document.createElement('div');
                    examTypeTitle.style.fontSize = '1.1rem';
                    examTypeTitle.style.fontWeight = 'bold';
                    examTypeTitle.style.color = '#2d3748';
                    examTypeTitle.style.marginBottom = '10px';
                    examTypeTitle.textContent = examType;
                    examGroup.appendChild(examTypeTitle);
                    
                    // 创建科目成绩容器
                    const subjectsContainer = document.createElement('div');
                    subjectsContainer.style.display = 'flex';
                    subjectsContainer.style.flexWrap = 'nowrap';
                    subjectsContainer.style.gap = '12px';
                    subjectsContainer.style.overflowX = 'auto';
                    subjectsContainer.style.paddingBottom = '5px';
                    
                    // 为每个科目创建成绩卡片
                    Object.entries(subjects).forEach(([subjectName, score]) => {
                        try {
                            // 创建成绩卡片，使用与学生总数卡片相似的样式
                            const scoreCard = document.createElement('div');
                            scoreCard.style.background = 'white';
                            scoreCard.style.borderRadius = '10px';
                            scoreCard.style.padding = '10px 15px';
                            scoreCard.style.boxShadow = '0 4px 6px rgba(0, 0, 0, 0.05)';
                            scoreCard.style.transition = 'all 0.3s ease';
                            scoreCard.style.display = 'flex';
                            scoreCard.style.alignItems = 'center';
                            scoreCard.style.justifyContent = 'center';
                            scoreCard.style.textAlign = 'center';
                            scoreCard.style.minWidth = '100px';
                            scoreCard.style.flexShrink = 0;
                            
                            // 添加悬停效果
                            scoreCard.addEventListener('mouseenter', function() {
                                scoreCard.style.transform = 'translateY(-5px)';
                                scoreCard.style.boxShadow = '0 10px 15px rgba(0, 0, 0, 0.1)';
                            });
                            
                            scoreCard.addEventListener('mouseleave', function() {
                                scoreCard.style.transform = 'translateY(0)';
                                scoreCard.style.boxShadow = '0 4px 6px rgba(0, 0, 0, 0.05)';
                            });
                            
                            // 添加科目内容
                            const subjectContent = document.createElement('div');
                            subjectContent.style.flex = '1';
                            
                            // 添加科目名称
                            const subjectNameElement = document.createElement('div');
                            subjectNameElement.style.fontWeight = 'bold';
                            subjectNameElement.style.color = '#718096';
                            subjectNameElement.style.marginBottom = '3px';
                            subjectNameElement.style.fontSize = '0.9rem';
                            subjectNameElement.textContent = subjectName;
                            subjectContent.appendChild(subjectNameElement);
                            
                            // 创建分数和箭头的容器
                            const scoreContainer = document.createElement('div');
                            scoreContainer.style.display = 'flex';
                            scoreContainer.style.alignItems = 'baseline';
                            scoreContainer.style.justifyContent = 'center';
                            scoreContainer.style.gap = '5px';
                            
                            // 添加分数
                            const scoreValue = document.createElement('div');
                            scoreValue.style.fontSize = '1.8rem';
                            scoreValue.style.fontWeight = 'bold';
                            scoreValue.style.color = '#5a67d8';
                            scoreValue.textContent = score;
                            scoreContainer.appendChild(scoreValue);
                            
                            // 添加成绩进退箭头（所有科目都进行比较）
                            // 获取当前科目的完整键名
                            const currentKey = `${examType}_${subjectName}`;
                            
                            // 检查当前数据是否存在
                            if (student.scores.hasOwnProperty(currentKey)) {
                                const currentValue = parseFloat(student.scores[currentKey]);
                                
                                if (!isNaN(currentValue)) {
                                    // 调试信息：输出当前科目和键名
                                    console.log('当前科目:', subjectName, '键名:', currentKey, '当前值:', currentValue);
                                    
                                    // 获取所有考试类型（从完整的student.scores中提取，确保不遗漏任何考试类型）
                                    const allExamTypes = [...new Set(
                                        Object.keys(student.scores)
                                            .map((subject) => {
                                                if (subject.includes('_')) {
                                                    return subject.split('_')[0];
                                                }
                                                return null;
                                            })
                                            .filter(examType => examType !== null)
                                    )];
                                    
                                    // 调试信息：输出所有考试类型
                                    console.log('所有考试类型:', allExamTypes);
                                    
                                    // 对考试类型进行排序（按考试顺序排列）
                                    allExamTypes.sort((a, b) => {
                                        // 尝试按数字部分排序，如月考1 < 月考2
                                        const numA = parseInt(a.match(/\d+/)?.[0] || '0');
                                        const numB = parseInt(b.match(/\d+/)?.[0] || '0');
                                        if (numA !== numB) return numA - numB;
                                        return a.localeCompare(b);
                                    });
                                    
                                    // 找到当前考试类型的索引
                                    const currentExamIndex = allExamTypes.indexOf(examType);
                                    
                                    // 调试信息：输出当前考试类型和索引
                                    console.log('当前考试类型:', examType, '索引:', currentExamIndex);
                                    
                                    // 判断是否为排名类型科目
                                    const isRankType = ['班次', '级次'].includes(subjectName);
                                    
                                    // 如果有上一次考试，则与上一次考试的相应科目比较
                                    if (currentExamIndex > 0) {
                                        const previousExamType = allExamTypes[currentExamIndex - 1];
                                        const previousKey = `${previousExamType}_${subjectName}`;
                                        
                                        // 检查上一次考试的相应科目数据是否存在
                                        if (student.scores.hasOwnProperty(previousKey)) {
                                            const previousValue = parseFloat(student.scores[previousKey]);
                                            
                                            if (!isNaN(previousValue)) {
                                                // 调试信息：输出比较数据
                                                console.log('与上一次考试比较:', previousExamType, previousKey, previousValue);
                                                
                                                // 创建箭头元素
                                                const arrowElement = document.createElement('i');
                                                arrowElement.style.fontSize = '1rem';
                                                
                                                if (isRankType) {
                                                    // 排名类型（班次、级次）：数值越小越好
                                                    if (currentValue < previousValue) {
                                                        arrowElement.className = 'fas fa-arrow-up';
                                                        arrowElement.style.color = '#e53e3e'; // 红色表示进步
                                                    } else if (currentValue > previousValue) {
                                                        arrowElement.className = 'fas fa-arrow-down';
                                                        arrowElement.style.color = '#48bb78'; // 绿色表示退步
                                                    } else {
                                                        arrowElement.className = 'fas fa-minus';
                                                        arrowElement.style.color = '#a0aec0'; // 灰色表示不变
                                                    }
                                                } else {
                                                    // 分数类型（语文、数学等）：数值越大越好
                                                    if (currentValue > previousValue) {
                                                        arrowElement.className = 'fas fa-arrow-up';
                                                        arrowElement.style.color = '#e53e3e'; // 红色表示进步
                                                    } else if (currentValue < previousValue) {
                                                        arrowElement.className = 'fas fa-arrow-down';
                                                        arrowElement.style.color = '#48bb78'; // 绿色表示退步
                                                    } else {
                                                        arrowElement.className = 'fas fa-minus';
                                                        arrowElement.style.color = '#a0aec0'; // 灰色表示不变
                                                    }
                                                }
                                                
                                                scoreContainer.appendChild(arrowElement);
                                            } else {
                                                console.log('上一次考试数据无效:', previousKey, previousValue);
                                            }
                                        } else {
                                            console.log('上一次考试数据不存在:', previousKey);
                                            // 尝试与高二末数据比较（针对级次）
                                            if (subjectName === '级次') {
                                                const previousKey = `${examType}_高二末级次`;
                                                if (student.scores.hasOwnProperty(previousKey)) {
                                                    const previousValue = parseFloat(student.scores[previousKey]);
                                                    
                                                    if (!isNaN(previousValue)) {
                                                        console.log('与高二末级次比较:', previousKey, previousValue);
                                                        
                                                        // 创建箭头元素
                                                        const arrowElement = document.createElement('i');
                                                        arrowElement.style.fontSize = '1rem';
                                                        
                                                        // 级次是排名类型，数值越小越好
                                                        if (currentValue < previousValue) {
                                                            arrowElement.className = 'fas fa-arrow-up';
                                                            arrowElement.style.color = '#e53e3e'; // 红色表示进步
                                                        } else if (currentValue > previousValue) {
                                                            arrowElement.className = 'fas fa-arrow-down';
                                                            arrowElement.style.color = '#48bb78'; // 绿色表示退步
                                                        } else {
                                                            arrowElement.className = 'fas fa-minus';
                                                            arrowElement.style.color = '#a0aec0'; // 灰色表示不变
                                                        }
                                                        
                                                        scoreContainer.appendChild(arrowElement);
                                                    }
                                                }
                                            }
                                        }
                                    } else {
                                        console.log('当前是第一次考试');
                                        // 如果是第一次考试，尝试与高二末数据比较（针对级次）
                                        if (subjectName === '级次') {
                                            const previousKey = `${examType}_高二末级次`;
                                            if (student.scores.hasOwnProperty(previousKey)) {
                                                const previousValue = parseFloat(student.scores[previousKey]);
                                                
                                                if (!isNaN(previousValue)) {
                                                    console.log('与高二末级次比较:', previousKey, previousValue);
                                                    
                                                    // 创建箭头元素
                                                    const arrowElement = document.createElement('i');
                                                    arrowElement.style.fontSize = '1rem';
                                                    
                                                    // 级次是排名类型，数值越小越好
                                                    if (currentValue < previousValue) {
                                                        arrowElement.className = 'fas fa-arrow-up';
                                                        arrowElement.style.color = '#e53e3e'; // 红色表示进步
                                                    } else if (currentValue > previousValue) {
                                                        arrowElement.className = 'fas fa-arrow-down';
                                                        arrowElement.style.color = '#48bb78'; // 绿色表示退步
                                                    } else {
                                                        arrowElement.className = 'fas fa-minus';
                                                        arrowElement.style.color = '#a0aec0'; // 灰色表示不变
                                                    }
                                                    
                                                    scoreContainer.appendChild(arrowElement);
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            
                            subjectContent.appendChild(scoreContainer);
                            scoreCard.appendChild(subjectContent);
                            
                            // 将成绩卡片添加到科目容器
                            subjectsContainer.appendChild(scoreCard);
                        } catch (error) {
                            console.error('创建成绩卡片时出错:', error);
                        }
                    });
                    
                    // 将科目容器添加到考试类型分组
                    examGroup.appendChild(subjectsContainer);
                    
                    // 将考试类型分组添加到主容器
                    scoresContainer.appendChild(examGroup);
                } catch (error) {
                    console.error('创建考试类型分组时出错:', error);
                }
            });
            
            // 确保成绩区域始终可见
            scoresSection.style.display = 'block';
            
            // 成绩区域不再显示柱状图，已移至成绩详情页面
        }
        

        

        
        // 事件监听器
        document.addEventListener('DOMContentLoaded', function() {
            // 确保所有DOM元素都已加载后再绑定事件
            // 所有事件绑定已移至主DOMContentLoaded处理器中
        });
        
        // 处理CSV文件
        function processCSV(file) {
            showDataStatus('正在处理文件...', 'warning');
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const csv = e.target.result;
                    const importResult = parseCSV(csv);
                    saveData();
                    updateClassSelector();
                    updateStats();
                    updateStudentTable();
                    showDataStatus(`成功导入数据，当前共有 ${students.length} 名学生`, 'success');
                    
                    // 显示导入结果提示框
                    alert(`导入成功！\n新导入学生：${importResult.newStudents} 名\n导入数据条数：${importResult.totalRecords} 条`);
                } catch (error) {
                    showDataStatus('CSV文件解析错误: ' + error.message, 'error');
                }
            };
            
            reader.onerror = function() {
                showDataStatus('文件读取失败', 'error');
            };
            
            reader.readAsText(file, 'UTF-8');
        }
        
        // 存储所有导入的表头信息，用于动态生成学生表格
        let allHeaders = [];
        
        // 存储所有导入的成绩科目信息，用于动态生成学生表格
        let allScoreSubjects = [];
        
        // 解析CSV数据
        function parseCSV(csv) {
            const lines = csv.split('\n').filter(line => line.trim() !== '');
            if (lines.length < 2) {
                throw new Error('CSV文件至少需要包含标题行和一行数据');
            }
            
            const requiredHeaders = ['班级', '座号', '姓名'];
            let headerIndex = -1;
            let headers;
            
            // 查找包含必需列的行作为标题行
            for (let i = 0; i < lines.length; i++) {
                headers = lines[i].split(',').map(header => header.trim());
                const missingHeaders = requiredHeaders.filter(h => !headers.includes(h));
                if (missingHeaders.length === 0) {
                    headerIndex = i;
                    break;
                }
            }
            
            // 检查是否找到有效的标题行
            if (headerIndex === -1) {
                throw new Error(`未找到包含必需列（${requiredHeaders.join(', ')}）的标题行`);
            }
            
            // 存储所有表头信息，用于动态生成学生表格
            allHeaders = headers;
            
            const classIndex = headers.indexOf('班级');
            const idIndex = headers.indexOf('座号');
            const nameIndex = headers.indexOf('姓名');
            
            // 检查是否有考试类型列
            const hasExamTypeColumn = headers.includes('考试类型');
            const examTypeIndex = hasExamTypeColumn ? headers.indexOf('考试类型') : -1;
            
            // 定义科目列（排除必需列和考试类型列）
            const subjectHeaders = headers.filter(h => 
                !requiredHeaders.includes(h) && h !== '考试类型'
            );
            
            // 解析数据行
            let importedCount = 0;
            let totalRecords = 0;
            let scoreRecords = 0;
            
            for (let i = headerIndex + 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(value => value.trim());
                if (values.length !== headers.length) continue;
                
                totalRecords++;
                
                const className = values[classIndex];
                const studentId = values[idIndex];
                const studentName = values[nameIndex];
                const examType = hasExamTypeColumn ? values[examTypeIndex] : '';
                
                if (!className || !studentId || !studentName) continue;
                
                // 查找是否已存在该学生（按班级+座号+姓名匹配）
                let student = students.find(s => 
                    s.class === className && 
                    s.id === studentId && 
                    s.name === studentName
                );
                
                // 如果不存在，则创建新学生
                if (!student) {
                    student = {
                        class: className,
                        id: studentId,
                        name: studentName,
                        scores: {}, // 直接使用scores对象存储所有科目成绩
                        // 存储所有其他列的数据
                        data: {}
                    };
                    students.push(student);
                    importedCount++;
                }
                
                // 确保必要的对象存在
                if (!student.scores) {
                    student.scores = {};
                }
                if (!student.data) {
                    student.data = {};
                }
                
                // 存储所有列的数据
                headers.forEach((header, index) => {
                    // 跳过已经单独存储的基本信息列
                    if (!requiredHeaders.includes(header)) {
                        student.data[header] = values[index];
                    }
                });
                
                // 处理各个科目的成绩
                subjectHeaders.forEach(subjectName => {
                    const scoreIndex = headers.indexOf(subjectName);
                    const score = values[scoreIndex];
                    if (score !== undefined && score !== '') {
                        // 根据是否有考试类型列来决定科目名称的格式
                        let finalSubjectName;
                        if (hasExamTypeColumn && examType) {
                            // 如果有考试类型列，则使用"考试类型_科目"的格式
                            finalSubjectName = `${examType}_${subjectName}`;
                        } else {
                            // 如果没有考试类型列，则直接使用完整的科目名称
                            finalSubjectName = subjectName;
                        }
                        
                        // 添加或更新科目成绩
                        student.scores[finalSubjectName] = score;
                        scoreRecords++;
                    }
                });
            }
            
            // 更新班级列表
            classes = [...new Set(students.map(s => s.class))];
            
            // 更新所有成绩科目列表
            updateAllScoreSubjects();
            
            // 返回导入结果
            return {
                newStudents: importedCount,
                totalRecords: totalRecords,
                scoreRecords: scoreRecords
            };
        }
        
        // 更新所有成绩科目列表
        function updateAllScoreSubjects() {
            const subjectSet = new Set();
            students.forEach(student => {
                if (student.scores) {
                    Object.keys(student.scores).forEach(subject => {
                        subjectSet.add(subject);
                    });
                }
            });
            allScoreSubjects = Array.from(subjectSet);
        }
        
        // 更新统计数据
        function updateStats() {
            studentCount.textContent = students.length;
            classCount.textContent = classes.length;
            
            // 计算科目数量
            const allSubjects = new Set();
            students.forEach(student => {
                if (student.scores) {
                    Object.keys(student.scores).forEach(subject => {
                        allSubjects.add(subject);
                    });
                }
            });
            subjectCount.textContent = allSubjects.size;
            
            // 更新所有成绩科目列表
            updateAllScoreSubjects();
        }
        
        // 考试类型功能已完全移除
        
        // 更新学生表格
        function updateStudentTable() {
            if (students.length === 0) {
                studentTableBody.innerHTML = '<tr><td colspan="4" style="text-align: center;">暂无学生数据</td></tr>';
                updatePaginationControls(0, 0, 0);
                return;
            }
            
            // 更新表头，显示所有导入的列和成绩科目
            const tableHeader = document.querySelector('.student-table thead tr');
            let headerHTML = '';
            
            // 添加基本信息列
            const requiredHeaders = ['班级', '座号', '姓名'];
            requiredHeaders.forEach(header => {
                headerHTML += `<th>${header}</th>`;
            });
            
            // 添加所有其他导入的列（非成绩列）
            if (allHeaders.length > 0) {
                allHeaders.forEach(header => {
                    // 跳过已经单独存储的基本信息列
                    if (!requiredHeaders.includes(header)) {
                        headerHTML += `<th>${header}</th>`;
                    }
                });
            }
            
            // 添加所有成绩科目列
            if (allScoreSubjects.length > 0) {
                allScoreSubjects.forEach(subject => {
                    headerHTML += `<th>${subject}</th>`;
                });
            }
            
            // 添加操作列
            headerHTML += '<th>操作</th>';
            
            tableHeader.innerHTML = headerHTML;
            
            // 处理分页
            pageSize = parseInt(pageSizeSelect.value) || 10;
            const totalPages = pageSize === 0 ? 1 : Math.ceil(students.length / pageSize);
            
            // 确保当前页在有效范围内
            if (currentPage > totalPages) currentPage = totalPages;
            if (currentPage < 1) currentPage = 1;
            
            // 获取当前页的学生数据
            let pageStudents;
            if (pageSize === 0) {
                // 显示全部
                pageStudents = students;
            } else {
                // 分页显示
                const startIndex = (currentPage - 1) * pageSize;
                const endIndex = Math.min(startIndex + pageSize, students.length);
                pageStudents = students.slice(startIndex, endIndex);
            }
            
            // 更新表格内容
            studentTableBody.innerHTML = '';
            pageStudents.forEach((student, index) => {
                // 计算全局索引用于删除操作
                const globalIndex = pageSize === 0 ? index : (currentPage - 1) * pageSize + index;
                
                const row = document.createElement('tr');
                let rowHTML = '';
                
                // 添加基本信息
                rowHTML += `
                    <td>${student.class}</td>
                    <td>${student.id}</td>
                    <td>${student.name}</td>
                `;
                
                // 添加所有其他导入的列数据（非成绩列）
                if (allHeaders.length > 0) {
                    allHeaders.forEach(header => {
                        // 跳过基本信息列
                        if (!requiredHeaders.includes(header)) {
                            // 从学生的data对象中获取数据，如果不存在则显示空
                            const value = student.data && student.data[header] ? student.data[header] : '';
                            rowHTML += `<td>${value}</td>`;
                        }
                    });
                }
                
                // 添加所有成绩科目数据
                if (allScoreSubjects.length > 0) {
                    allScoreSubjects.forEach(subject => {
                        // 从学生的scores对象中获取成绩数据，如果不存在则显示空
                        const score = student.scores && student.scores[subject] ? student.scores[subject] : '';
                        rowHTML += `<td>${score}</td>`;
                    });
                }
                
                // 添加操作列
                rowHTML += `
                    <td>
                        <button class="btn-danger" style="padding: 5px 10px; font-size: 0.9rem;" onclick="deleteStudent(${globalIndex})">
                            <i class="fas fa-trash"></i> 删除
                        </button>
                    </td>
                `;
                
                row.innerHTML = rowHTML;
                studentTableBody.appendChild(row);
            });
            
            // 更新分页控件
            updatePaginationControls(currentPage, totalPages, students.length);
        }
        
        // 更新分页控件
        function updatePaginationControls(currentPage, totalPages, totalItems) {
            // 更新分页信息
            if (totalItems === 0) {
                paginationInfo.textContent = '无数据';
            } else if (pageSize === 0) {
                paginationInfo.textContent = `共 ${totalItems} 条记录`;
            } else {
                const startItem = (currentPage - 1) * pageSize + 1;
                const endItem = Math.min(currentPage * pageSize, totalItems);
                paginationInfo.textContent = `第 ${startItem}-${endItem} 条，共 ${totalItems} 条记录`;
            }
            
            // 更新上一页/下一页按钮状态
            prevPageBtn.disabled = currentPage <= 1;
            nextPageBtn.disabled = currentPage >= totalPages || totalPages === 0;
            
            // 更新页码按钮
            pageNumbers.innerHTML = '';
            if (totalPages > 0 && pageSize !== 0) {
                const maxVisiblePages = 5;
                let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
                let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
                
                // 调整起始页
                if (endPage - startPage + 1 < maxVisiblePages) {
                    startPage = Math.max(1, endPage - maxVisiblePages + 1);
                }
                
                // 添加页码按钮
                for (let i = startPage; i <= endPage; i++) {
                    const pageBtn = document.createElement('span');
                    pageBtn.className = `page-number ${i === currentPage ? 'active' : ''}`;
                    pageBtn.textContent = i;
                    pageBtn.onclick = () => {
                        currentPage = i;
                        updateStudentTable();
                    };
                    pageNumbers.appendChild(pageBtn);
                }
            }
        }
        
        // 上一页
        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                updateStudentTable();
            }
        }
        
        // 下一页
        function nextPage() {
            pageSize = parseInt(pageSizeSelect.value) || 10;
            const totalPages = pageSize === 0 ? 1 : Math.ceil(students.length / pageSize);
            if (currentPage < totalPages) {
                currentPage++;
                updateStudentTable();
            }
        }
        
        // 显示状态消息
        function showDataStatus(message, type) {
            dataStatus.textContent = message;
            dataStatus.className = `status-message ${type}`;
            dataStatus.classList.remove('hidden');
            setTimeout(() => {
                dataStatus.classList.add('hidden');
            }, 3000);
        }
        
        // 删除学生
        function deleteStudent(index) {
            if (confirm(`确定要删除学生 ${students[index].name} 吗？`)) {
                students.splice(index, 1);
                saveData();
                updateClassSelector();
                updateStats();
                updateStudentTable();
                showDataStatus('学生删除成功', 'success');
            }
        }
        
        // 清空所有数据
        function clearAllData(skipConfirmation = false) {
            console.log('清空所有数据函数被调用');
            
            // 如果不需要跳过确认，则显示确认对话框
            if (!skipConfirmation) {
                console.log('显示确认对话框');
                if (!confirm('确定要清空所有学生数据吗？此操作不可恢复！')) {
                    console.log('用户取消了清空操作');
                    return; // 用户取消操作
                }
            }
            
            console.log('开始清空数据...');
            
            // 清空所有数据
            students = [];
            classes = [];
            allHeaders = [];
            allScoreSubjects = [];
            selectedSubjects = [];
            
            // 清空所有相关的本地存储键
            localStorage.removeItem('studentData');
            localStorage.removeItem('students');
            localStorage.removeItem('classes');
            localStorage.removeItem('subjects');
            localStorage.removeItem('selectedSubjects');
            
            console.log('本地存储已清空');
            
            // 更新所有UI组件
            try {
                updateClassSelector();
                updateStats();
                updateStudentTable();
                updateSubjectFilter();
                console.log('UI组件已更新');
            } catch (error) {
                console.error('更新UI时出错:', error);
            }
            
            // 清空成绩显示和选择的科目
            try {
                document.getElementById('scoresContainer').innerHTML = '';
                document.getElementById('selectedSubjects').innerHTML = '';
                console.log('成绩显示和选择的科目已清空');
            } catch (error) {
                console.error('清空成绩显示时出错:', error);
            }
            
            // 清空主页班级选择
            try {
                const classCheckboxes = document.getElementById('classCheckboxes');
                if (classCheckboxes) {
                    classCheckboxes.innerHTML = '';
                    console.log('主页班级选择已清空');
                }
            } catch (error) {
                console.error('清空主页班级选择时出错:', error);
            }
            
            // 重置主页显示
            try {
                if (rollerContent) {
                    rollerContent.innerHTML = '点击开始抽取';
                    console.log('主页显示已重置');
                }
                const selectedStudentScores = document.getElementById('selectedStudentScores');
                if (selectedStudentScores) {
                    selectedStudentScores.style.display = 'none';
                    console.log('选中学生成绩显示已隐藏');
                }
            } catch (error) {
                console.error('重置主页显示时出错:', error);
            }
            
            // 显示成功消息
            try {
                showDataStatus('所有数据已清空', 'success');
                console.log('清空数据操作完成');
                alert('所有数据已成功清空！');
            } catch (error) {
                console.error('显示成功消息时出错:', error);
            }
        }
    </script>
</body>
</html>