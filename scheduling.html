<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>教师排课系统</title>
    <!-- Tailwind CSS v3 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- FullCalendar CSS -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
    <!-- FullCalendar JS -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/locales/zh-cn.js"></script>
    
    <style>
        .transition-all-300 {
            transition: all 0.3s ease;
        }
        .card {
            background-color: #fff;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 1.5rem;
            transition: all 0.3s ease;
        }
        .card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .btn {
            padding-left: 1rem;
            padding-right: 1rem;
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
            border-radius: 0.375rem;
            font-weight: 500;
            transition: all 0.3s ease;
            outline: 2px solid transparent;
            outline-offset: 2px;
        }
        .btn-primary {
            background-color: #1e40af;
            color: #fff;
        }
        .btn-primary:hover {
            background-color: #1e3a8a;
        }
        .btn-accent {
            background-color: #f97316;
            color: #fff;
        }
        .btn-accent:hover {
            background-color: #ea580c;
        }
        .btn-outline {
            border: 1px solid #d1d5db;
            color: #374151;
        }
        .btn-outline:hover {
            background-color: #f9fafb;
        }
        .input-field {
            width: 100%;
            padding-left: 0.75rem;
            padding-right: 0.75rem;
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            outline: 2px solid transparent;
            outline-offset: 2px;
        }
        .input-field:focus {
            outline: 2px solid transparent;
            outline-offset: 2px;
            border-color: #1e40af;
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.3);
        }
        .label {
            display: block;
            font-size: 0.875rem;
            line-height: 1.25rem;
            font-weight: 500;
            color: #374151;
            margin-bottom: 0.25rem;
        }
    </style>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1e40af', // 教育蓝
                        secondary: '#f5f5dc', // 柔和米色
                        accent: '#f97316', // 活力橙
                        dark: '#0f172a',
                        light: '#f8fafc'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    boxShadow: {
                        'card': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
                        'card-hover': '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="flex h-screen overflow-hidden">
        <!-- 侧边导航栏 -->
        <aside class="w-64 bg-white shadow-md hidden md:block">
            <div class="p-6">
                <h1 class="text-xl font-bold text-primary flex items-center">
                    <i class="fa fa-calendar mr-2"></i>
                    教师排课系统
                </h1>
            </div>
            <nav class="mt-6 px-2">
                <div class="nav-link active mb-1" data-page="scheduler">
                    <i class="fa fa-calendar w-5 h-5 mr-3"></i>
                    <span>排课日历</span>
                </div>
                <div class="nav-link mb-1" data-page="courses">
                    <i class="fa fa-book w-5 h-5 mr-3"></i>
                    <span>课程管理</span>
                </div>
                <div class="nav-link mb-1" data-page="teachers">
                    <i class="fa fa-users w-5 h-5 mr-3"></i>
                    <span>教师管理</span>
                </div>
                <div class="nav-link mb-1" data-page="rooms">
                    <i class="fa fa-building w-5 h-5 mr-3"></i>
                    <span>教室管理</span>
                </div>
            </nav>
            <div class="absolute bottom-0 w-64 p-6">
                <button id="backToMain" class="btn btn-outline w-full flex items-center justify-center">
                    <i class="fa fa-arrow-left mr-2"></i>
                    返回主系统
                </button>
            </div>
        </aside>

        <!-- 主内容区 -->
        <main class="flex-1 overflow-y-auto bg-gray-50">
            <!-- 顶部栏 -->
            <header class="bg-white shadow-sm">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
                    <div>
                        <h2 id="pageTitle" class="text-lg font-medium text-gray-900">排课日历</h2>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button id="todayBtn" class="btn btn-outline">
                            今天
                        </button>
                        <div class="flex items-center space-x-2">
                            <button id="prevBtn" class="btn btn-outline p-2">
                                <i class="fa fa-chevron-left"></i>
                            </button>
                            <button id="nextBtn" class="btn btn-outline p-2">
                                <i class="fa fa-chevron-right"></i>
                            </button>
                        </div>
                        <h2 id="calendarTitle" class="text-lg font-medium text-gray-900"></h2>
                        <div class="relative">
                            <select id="viewSelect" class="input-field appearance-none pr-10">
                                <option value="dayGridMonth">月视图</option>
                                <option value="timeGridWeek">周视图</option>
                                <option value="timeGridDay">日视图</option>
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                                <i class="fa fa-chevron-down text-xs"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- 页面内容 -->
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <!-- 排课日历页面 -->
                <div id="scheduler-page" class="page-content">
                    <div class="card">
                        <div id="calendar"></div>
                    </div>
                </div>

                <!-- 课程管理页面 -->
                <div id="courses-page" class="page-content hidden">
                    <div class="card mb-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-medium text-gray-900">课程管理</h3>
                            <button id="addCourseBtn" class="btn btn-primary">
                                <i class="fa fa-plus mr-1"></i> 添加课程
                            </button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead>
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">课程名称</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">课程代码</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">学分</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">学期</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <tr>
                                        <td colspan="5" class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center">暂无数据</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 教师管理页面 -->
                <div id="teachers-page" class="page-content hidden">
                    <div class="card mb-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-medium text-gray-900">教师管理</h3>
                            <button id="addTeacherBtn" class="btn btn-primary">
                                <i class="fa fa-plus mr-1"></i> 添加教师
                            </button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead>
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">姓名</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">工号</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">职称</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">所属院系</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <tr>
                                        <td colspan="5" class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center">暂无数据</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 教室管理页面 -->
                <div id="rooms-page" class="page-content hidden">
                    <div class="card mb-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-medium text-gray-900">教室管理</h3>
                            <button id="addRoomBtn" class="btn btn-primary">
                                <i class="fa fa-plus mr-1"></i> 添加教室
                            </button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead>
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">教室名称</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">教室编号</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">容量</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">设备</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <tr>
                                        <td colspan="5" class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center">暂无数据</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 添加课程模态框 -->
    <div id="addCourseModal" class="fixed inset-0 bg-gray-900/50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-medium text-gray-900">添加课程</h3>
                    <button id="closeCourseModal" class="text-gray-400 hover:text-gray-500">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
                <form id="addCourseForm">
                    <div class="mb-4">
                        <label for="courseName" class="label">课程名称</label>
                        <input type="text" id="courseName" name="courseName" class="input-field" required>
                    </div>
                    <div class="mb-4">
                        <label for="courseCode" class="label">课程代码</label>
                        <input type="text" id="courseCode" name="courseCode" class="input-field" required>
                    </div>
                    <div class="mb-4">
                        <label for="credits" class="label">学分</label>
                        <input type="number" id="credits" name="credits" class="input-field" min="1" max="10" required>
                    </div>
                    <div class="mb-4">
                        <label for="semester" class="label">学期</label>
                        <select id="semester" name="semester" class="input-field" required>
                            <option value="">选择学期</option>
                            <option value="春季学期">春季学期</option>
                            <option value="秋季学期">秋季学期</option>
                        </select>
                    </div>
                    <div class="flex justify-end mt-6">
                        <button type="button" id="cancelAddCourse" class="btn btn-outline mr-3">取消</button>
                        <button type="submit" class="btn btn-primary">保存</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 添加教师模态框 -->
    <div id="addTeacherModal" class="fixed inset-0 bg-gray-900/50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-medium text-gray-900">添加教师</h3>
                    <button id="closeTeacherModal" class="text-gray-400 hover:text-gray-500">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
                <form id="addTeacherForm">
                    <div class="mb-4">
                        <label for="teacherName" class="label">姓名</label>
                        <input type="text" id="teacherName" name="teacherName" class="input-field" required>
                    </div>
                    <div class="mb-4">
                        <label for="employeeId" class="label">工号</label>
                        <input type="text" id="employeeId" name="employeeId" class="input-field" required>
                    </div>
                    <div class="mb-4">
                        <label for="title" class="label">职称</label>
                        <select id="title" name="title" class="input-field" required>
                            <option value="">选择职称</option>
                            <option value="助教">助教</option>
                            <option value="讲师">讲师</option>
                            <option value="副教授">副教授</option>
                            <option value="教授">教授</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label for="department" class="label">所属院系</label>
                        <input type="text" id="department" name="department" class="input-field" required>
                    </div>
                    <div class="flex justify-end mt-6">
                        <button type="button" id="cancelAddTeacher" class="btn btn-outline mr-3">取消</button>
                        <button type="submit" class="btn btn-primary">保存</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 添加教室模态框 -->
    <div id="addRoomModal" class="fixed inset-0 bg-gray-900/50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-medium text-gray-900">添加教室</h3>
                    <button id="closeRoomModal" class="text-gray-400 hover:text-gray-500">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
                <form id="addRoomForm">
                    <div class="mb-4">
                        <label for="roomName" class="label">教室名称</label>
                        <input type="text" id="roomName" name="roomName" class="input-field" required>
                    </div>
                    <div class="mb-4">
                        <label for="roomNumber" class="label">教室编号</label>
                        <input type="text" id="roomNumber" name="roomNumber" class="input-field" required>
                    </div>
                    <div class="mb-4">
                        <label for="capacity" class="label">容量</label>
                        <input type="number" id="capacity" name="capacity" class="input-field" min="1" required>
                    </div>
                    <div class="mb-4">
                        <label for="equipment" class="label">设备</label>
                        <textarea id="equipment" name="equipment" rows="3" class="input-field" placeholder="例如：投影仪,白板,音响"></textarea>
                    </div>
                    <div class="flex justify-end mt-6">
                        <button type="button" id="cancelAddRoom" class="btn btn-outline mr-3">取消</button>
                        <button type="submit" class="btn btn-primary">保存</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 添加排课模态框 -->
    <div id="addScheduleModal" class="fixed inset-0 bg-gray-900/50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-medium text-gray-900">添加排课</h3>
                    <button id="closeScheduleModal" class="text-gray-400 hover:text-gray-500">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
                <form id="addScheduleForm">
                    <div class="mb-4">
                        <label for="scheduleCourse" class="label">课程</label>
                        <select id="scheduleCourse" name="scheduleCourse" class="input-field" required>
                            <option value="">选择课程</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label for="scheduleTeacher" class="label">教师</label>
                        <select id="scheduleTeacher" name="scheduleTeacher" class="input-field" required>
                            <option value="">选择教师</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label for="scheduleRoom" class="label">教室</label>
                        <select id="scheduleRoom" name="scheduleRoom" class="input-field" required>
                            <option value="">选择教室</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label for="scheduleDate" class="label">日期</label>
                        <input type="date" id="scheduleDate" name="scheduleDate" class="input-field" required>
                    </div>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="startTime" class="label">开始时间</label>
                            <input type="time" id="startTime" name="startTime" class="input-field" required>
                        </div>
                        <div>
                            <label for="endTime" class="label">结束时间</label>
                            <input type="time" id="endTime" name="endTime" class="input-field" required>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label for="scheduleNotes" class="label">备注</label>
                        <textarea id="scheduleNotes" name="scheduleNotes" rows="3" class="input-field"></textarea>
                    </div>
                    <div class="flex justify-end mt-6">
                        <button type="button" id="cancelAddSchedule" class="btn btn-outline mr-3">取消</button>
                        <button type="submit" class="btn btn-primary">保存</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // 数据存储
        let courses = JSON.parse(localStorage.getItem('courses')) || [];
        let teachers = JSON.parse(localStorage.getItem('teachers')) || [];
        let rooms = JSON.parse(localStorage.getItem('rooms')) || [];
        let schedules = JSON.parse(localStorage.getItem('schedules')) || [];

        let calendar;

        // 初始化应用
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化FullCalendar
            var calendarEl = document.getElementById('calendar');
            calendar = new FullCalendar.Calendar(calendarEl, {
                locale: 'zh-cn',
                headerToolbar: false,
                initialView: 'dayGridMonth',
                editable: true,
                selectable: true,
                events: getSchedulesAsEvents(),
                dateClick: function(info) {
                    openScheduleModal(info.dateStr);
                },
                eventClick: function(info) {
                    // 点击事件时的处理逻辑
                    alert('Event: ' + info.event.title);
                    alert('Coordinates: ' + info.jsEvent.pageX + ',' + info.jsEvent.pageY);
                }
            });
            calendar.render();

            // 更新日历标题
            updateCalendarTitle();

            // 初始化事件监听器
            initEventListeners();

            // 更新下拉选项
            updateSelectOptions();
        });

        // 获取排课作为日历事件
        function getSchedulesAsEvents() {
            return schedules.map(schedule => {
                const course = courses.find(c => c.id === schedule.courseId);
                const teacher = teachers.find(t => t.id === schedule.teacherId);
                const room = rooms.find(r => r.id === schedule.roomId);
                
                return {
                    id: schedule.id,
                    title: `${course ? course.name : '未知课程'}\n${teacher ? teacher.name : '未知教师'}\n${room ? room.name : '未知教室'}`,
                    start: `${schedule.date}T${schedule.startTime}`,
                    end: `${schedule.date}T${schedule.endTime}`,
                    allDay: false
                };
            });
        }

        // 初始化事件监听器
        function initEventListeners() {
            // 导航链接点击事件
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function() {
                    const pageId = this.getAttribute('data-page');
                    showPage(pageId);
                    
                    // 更新导航链接状态
                    document.querySelectorAll('.nav-link').forEach(navLink => {
                        navLink.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // 更新页面标题
                    document.getElementById('pageTitle').textContent = this.querySelector('span').textContent;
                });
            });

            // 日历控制按钮
            document.getElementById('todayBtn').addEventListener('click', function() {
                calendar.today();
                updateCalendarTitle();
            });

            document.getElementById('prevBtn').addEventListener('click', function() {
                calendar.prev();
                updateCalendarTitle();
            });

            document.getElementById('nextBtn').addEventListener('click', function() {
                calendar.next();
                updateCalendarTitle();
            });

            document.getElementById('viewSelect').addEventListener('change', function() {
                calendar.changeView(this.value);
            });

            // 模态框事件
            document.getElementById('addCourseBtn').addEventListener('click', function() {
                document.getElementById('addCourseModal').classList.remove('hidden');
            });

            document.getElementById('closeCourseModal').addEventListener('click', function() {
                document.getElementById('addCourseModal').classList.add('hidden');
            });

            document.getElementById('cancelAddCourse').addEventListener('click', function() {
                document.getElementById('addCourseModal').classList.add('hidden');
            });

            document.getElementById('addTeacherBtn').addEventListener('click', function() {
                document.getElementById('addTeacherModal').classList.remove('hidden');
            });

            document.getElementById('closeTeacherModal').addEventListener('click', function() {
                document.getElementById('addTeacherModal').classList.add('hidden');
            });

            document.getElementById('cancelAddTeacher').addEventListener('click', function() {
                document.getElementById('addTeacherModal').classList.add('hidden');
            });

            document.getElementById('addRoomBtn').addEventListener('click', function() {
                document.getElementById('addRoomModal').classList.remove('hidden');
            });

            document.getElementById('closeRoomModal').addEventListener('click', function() {
                document.getElementById('addRoomModal').classList.add('hidden');
            });

            document.getElementById('cancelAddRoom').addEventListener('click', function() {
                document.getElementById('addRoomModal').classList.add('hidden');
            });

            document.getElementById('closeScheduleModal').addEventListener('click', function() {
                document.getElementById('addScheduleModal').classList.add('hidden');
            });

            document.getElementById('cancelAddSchedule').addEventListener('click', function() {
                document.getElementById('addScheduleModal').classList.add('hidden');
            });

            // 表单提交事件
            document.getElementById('addCourseForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addCourse();
            });

            document.getElementById('addTeacherForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addTeacher();
            });

            document.getElementById('addRoomForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addRoom();
            });

            document.getElementById('addScheduleForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addSchedule();
            });

            // 返回主系统按钮
            document.getElementById('backToMain').addEventListener('click', function() {
                window.location.href = 'index.html';
            });
        }

        // 显示指定页面
        function showPage(pageId) {
            // 隐藏所有页面
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.add('hidden');
            });
            
            // 显示目标页面
            const targetPage = document.getElementById(`${pageId}-page`);
            if (targetPage) {
                targetPage.classList.remove('hidden');
            }
        }

        // 更新日历标题
        function updateCalendarTitle() {
            document.getElementById('calendarTitle').textContent = calendar.view.title;
        }

        // 打开排课模态框
        function openScheduleModal(date) {
            // 设置默认日期
            document.getElementById('scheduleDate').value = date;
            
            // 更新下拉选项
            updateSelectOptions();
            
            // 显示模态框
            document.getElementById('addScheduleModal').classList.remove('hidden');
        }

        // 更新下拉选项
        function updateSelectOptions() {
            // 更新课程下拉选项
            const courseSelects = [document.getElementById('scheduleCourse')];
            courseSelects.forEach(select => {
                if (select) {
                    select.innerHTML = '<option value="">选择课程</option>';
                    courses.forEach(course => {
                        const option = document.createElement('option');
                        option.value = course.id;
                        option.textContent = course.name;
                        select.appendChild(option);
                    });
                }
            });

            // 更新教师下拉选项
            const teacherSelects = [document.getElementById('scheduleTeacher')];
            teacherSelects.forEach(select => {
                if (select) {
                    select.innerHTML = '<option value="">选择教师</option>';
                    teachers.forEach(teacher => {
                        const option = document.createElement('option');
                        option.value = teacher.id;
                        option.textContent = teacher.name;
                        select.appendChild(option);
                    });
                }
            });

            // 更新教室下拉选项
            const roomSelects = [document.getElementById('scheduleRoom')];
            roomSelects.forEach(select => {
                if (select) {
                    select.innerHTML = '<option value="">选择教室</option>';
                    rooms.forEach(room => {
                        const option = document.createElement('option');
                        option.value = room.id;
                        option.textContent = room.name;
                        select.appendChild(option);
                    });
                }
            });
        }

        // 添加课程
        function addCourse() {
            const name = document.getElementById('courseName').value;
            const code = document.getElementById('courseCode').value;
            const credits = document.getElementById('credits').value;
            const semester = document.getElementById('semester').value;

            // 验证输入
            if (!name || !code || !credits || !semester) {
                alert('请填写所有必填字段');
                return;
            }

            // 创建新课程
            const newCourse = {
                id: generateId(),
                name,
                code,
                credits: parseInt(credits),
                semester,
                createdAt: new Date().toISOString()
            };

            // 添加到数组
            courses.push(newCourse);

            // 保存到本地存储
            localStorage.setItem('courses', JSON.stringify(courses));

            // 重置表单
            document.getElementById('addCourseForm').reset();

            // 关闭模态框
            document.getElementById('addCourseModal').classList.add('hidden');

            // 显示成功消息
            alert('课程添加成功');
        }

        // 添加教师
        function addTeacher() {
            const name = document.getElementById('teacherName').value;
            const employeeId = document.getElementById('employeeId').value;
            const title = document.getElementById('title').value;
            const department = document.getElementById('department').value;

            // 验证输入
            if (!name || !employeeId || !title || !department) {
                alert('请填写所有必填字段');
                return;
            }

            // 创建新教师
            const newTeacher = {
                id: generateId(),
                name,
                employeeId,
                title,
                department,
                createdAt: new Date().toISOString()
            };

            // 添加到数组
            teachers.push(newTeacher);

            // 保存到本地存储
            localStorage.setItem('teachers', JSON.stringify(teachers));

            // 重置表单
            document.getElementById('addTeacherForm').reset();

            // 关闭模态框
            document.getElementById('addTeacherModal').classList.add('hidden');

            // 显示成功消息
            alert('教师添加成功');
        }

        // 添加教室
        function addRoom() {
            const name = document.getElementById('roomName').value;
            const number = document.getElementById('roomNumber').value;
            const capacity = document.getElementById('capacity').value;
            const equipment = document.getElementById('equipment').value;

            // 验证输入
            if (!name || !number || !capacity) {
                alert('请填写所有必填字段');
                return;
            }

            // 创建新教室
            const newRoom = {
                id: generateId(),
                name,
                number,
                capacity: parseInt(capacity),
                equipment,
                createdAt: new Date().toISOString()
            };

            // 添加到数组
            rooms.push(newRoom);

            // 保存到本地存储
            localStorage.setItem('rooms', JSON.stringify(rooms));

            // 重置表单
            document.getElementById('addRoomForm').reset();

            // 关闭模态框
            document.getElementById('addRoomModal').classList.add('hidden');

            // 显示成功消息
            alert('教室添加成功');
        }

        // 添加排课
        function addSchedule() {
            const courseId = document.getElementById('scheduleCourse').value;
            const teacherId = document.getElementById('scheduleTeacher').value;
            const roomId = document.getElementById('scheduleRoom').value;
            const date = document.getElementById('scheduleDate').value;
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            const notes = document.getElementById('scheduleNotes').value;

            // 验证输入
            if (!courseId || !teacherId || !roomId || !date || !startTime || !endTime) {
                alert('请填写所有必填字段');
                return;
            }

            // 检查时间冲突
            const conflict = schedules.find(schedule => 
                schedule.date === date &&
                schedule.roomId === roomId &&
                ((startTime >= schedule.startTime && startTime < schedule.endTime) ||
                 (endTime > schedule.startTime && endTime <= schedule.endTime) ||
                 (startTime <= schedule.startTime && endTime >= schedule.endTime))
            );

            if (conflict) {
                alert('时间或教室冲突，请检查排课安排');
                return;
            }

            // 创建新排课
            const newSchedule = {
                id: generateId(),
                courseId,
                teacherId,
                roomId,
                date,
                startTime,
                endTime,
                notes,
                createdAt: new Date().toISOString()
            };

            // 添加到数组
            schedules.push(newSchedule);

            // 保存到本地存储
            localStorage.setItem('schedules', JSON.stringify(schedules));

            // 更新日历
            calendar.addEvent({
                id: newSchedule.id,
                title: `${getCouseName(courseId)}\n${getTeacherName(teacherId)}\n${getRoomName(roomId)}`,
                start: `${date}T${startTime}`,
                end: `${date}T${endTime}`,
                allDay: false
            });

            // 重置表单
            document.getElementById('addScheduleForm').reset();

            // 关闭模态框
            document.getElementById('addScheduleModal').classList.add('hidden');

            // 显示成功消息
            alert('排课添加成功');
        }

        // 获取课程名称
        function getCouseName(courseId) {
            const course = courses.find(c => c.id === courseId);
            return course ? course.name : '未知课程';
        }

        // 获取教师名称
        function getTeacherName(teacherId) {
            const teacher = teachers.find(t => t.id === teacherId);
            return teacher ? teacher.name : '未知教师';
        }

        // 获取教室名称
        function getRoomName(roomId) {
            const room = rooms.find(r => r.id === roomId);
            return room ? room.name : '未知教室';
        }

        // 生成唯一ID
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
        }
    </script>
</body>
</html>